<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#5698c3"><meta name="author" content="语轻星子"><meta name="copyright" content="语轻星子"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>CodeWhy-JavaScript高级-学习笔记2 | 轻语馆</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js" defer></script><script src="/js/pjax.js" defer></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#5698c3"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"xxcijmz.top","root":"/","title":"轻语馆","version":"1.6.2","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"/data/sentences.json"},"algolia":{"appID":"I6Q6TFSWKC","apiKey":"8299a265813c86a465cc32755761abc9","indexName":"blogs","hits":{"per_page":10}}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="stylesheet" href="/css/content.css"><script src="//at.alicdn.com/t/font_3171041_jyp164m1jzi.js" async></script><meta name="description" content="Iterator - generator什么是迭代器？ 迭代器（iterator），是确使用户可在容器对象（container，例如链表或数组）上遍访的对象，使用该接口无需关心对象的内部实现细节。（迭代器本身就是一个对象，这个对象可以帮助我们遍历另外一个容器对象）  其行为像数据库中的光标，迭代器最早出现在1974年设计的CLU编程语言中；  在各种编程语言的实现中，迭代器的实现方式各不相同，但是">
<meta property="og:type" content="article">
<meta property="og:title" content="CodeWhy-JavaScript高级-学习笔记2">
<meta property="og:url" content="https://xxcijmz.top/blogs/6af01b42/index.html">
<meta property="og:site_name" content="轻语馆">
<meta property="og:description" content="Iterator - generator什么是迭代器？ 迭代器（iterator），是确使用户可在容器对象（container，例如链表或数组）上遍访的对象，使用该接口无需关心对象的内部实现细节。（迭代器本身就是一个对象，这个对象可以帮助我们遍历另外一个容器对象）  其行为像数据库中的光标，迭代器最早出现在1974年设计的CLU编程语言中；  在各种编程语言的实现中，迭代器的实现方式各不相同，但是">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/58.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/1.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/2.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/3.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/4.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/5.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/6.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/7.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/8.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/9.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/10.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/11.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/12.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/13.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/14.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/15.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/16.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/17.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/18.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/19.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/20.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/21.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/22.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/23.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/24.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/25.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/26.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/27.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/28.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/29.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/30.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/31.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/32.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/33.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/34.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/35.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/36.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/37.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/38.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/39.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/40.jpg">
<meta property="og:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/41.jpg">
<meta property="og:image" content="https://xxcijmz.top/blogs/6af01b42/42.jpg">
<meta property="og:image" content="https://xxcijmz.top/blogs/6af01b42/.jpg">
<meta property="article:published_time" content="2022-02-07T06:55:34.000Z">
<meta property="article:modified_time" content="2022-02-14T05:11:22.193Z">
<meta property="article:author" content="语轻星子">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/58.jpg"><script src="/js/ui/mode.js"></script></head><body><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="语轻星子"><img width="96" loading="lazy" src="https://cdn.jsdelivr.net/gh/xxc-yqxz/xxc-yqxz.github.io/images/avatar.jpg" alt="语轻星子"></a><div class="site-author-name"><a href="/about/">语轻星子</a></div><span class="site-name">轻语馆</span><sub class="site-subtitle">我也会加油，所以你也要加油，这是约定</sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">49</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">17</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">18</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://github.com/xxc-yqxz/xxc-yqxz.github.io" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=894043590&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=1379764422" title="网易云音乐" target="_blank" style="color:#C10D0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/269921139" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/demoShow/" title="布局练习" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-css"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Iterator-generator"><span class="toc-number">1.</span> <span class="toc-text">Iterator - generator</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">什么是迭代器？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.</span> <span class="toc-text">可迭代对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.3.</span> <span class="toc-text">元素可迭代对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.</span> <span class="toc-text">可迭代对象的应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E7%9A%84%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.5.</span> <span class="toc-text">自定义类的迭代</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">1.6.</span> <span class="toc-text">什么是生成器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C"><span class="toc-number">1.7.</span> <span class="toc-text">生成器函数执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0-%E2%80%93-next%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.</span> <span class="toc-text">生成器传递参数 – next函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E6%8F%90%E5%89%8D%E7%BB%93%E6%9D%9F-%E2%80%93-return%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.</span> <span class="toc-text">生成器提前结束 – return函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8-%E2%80%93-throw%E5%87%BD%E6%95%B0"><span class="toc-number">1.10.</span> <span class="toc-text">生成器抛出异常 – throw函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E6%9B%BF%E4%BB%A3%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%BD%BF%E7%94%A8"><span class="toc-number">1.11.</span> <span class="toc-text">生成器替代迭代器使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E8%BF%AD%E4%BB%A3-%E2%80%93-%E7%94%9F%E6%88%90%E5%99%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.12.</span> <span class="toc-text">自定义类迭代 – 生成器实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88"><span class="toc-number">1.13.</span> <span class="toc-text">异步处理方案</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#async-await-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.</span> <span class="toc-text">async - await - 事件循环</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0-async-function"><span class="toc-number">2.1.</span> <span class="toc-text">异步函数 async function</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">异步函数的执行流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#await-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">2.3.</span> <span class="toc-text">await 关键字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B"><span class="toc-number">2.4.</span> <span class="toc-text">进程和线程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="toc-number">2.5.</span> <span class="toc-text">操作系统的工作方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84-JavaScript-%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.6.</span> <span class="toc-text">浏览器中的 JavaScript 进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.7.</span> <span class="toc-text">浏览器的事件循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8F%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%BE%AE%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.8.</span> <span class="toc-text">宏任务和微任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.9.</span> <span class="toc-text">Node 的事件循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E7%9A%84%E9%98%B6%E6%AE%B5"><span class="toc-number">2.10.</span> <span class="toc-text">Node 事件循环的阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-%E7%9A%84%E5%AE%8F%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%BE%AE%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.11.</span> <span class="toc-text">Node 的宏任务与微任务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88"><span class="toc-number">3.</span> <span class="toc-text">错误处理方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#throw%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">3.1.</span> <span class="toc-text">throw关键字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Error-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">Error 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">3.3.</span> <span class="toc-text">异常的处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E7%9A%84%E6%8D%95%E8%8E%B7"><span class="toc-number">3.4.</span> <span class="toc-text">异常的捕获</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaScript-%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">JavaScript 模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9D%97%E5%8C%96%EF%BC%9F"><span class="toc-number">4.1.</span> <span class="toc-text">什么是模块化？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="toc-number">4.2.</span> <span class="toc-text">模块化的历史</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E6%A8%A1%E5%9D%97%E5%8C%96%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.3.</span> <span class="toc-text">没有模块化带来的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Commonjs-%E8%A7%84%E8%8C%83%E5%92%8C-nodejs-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">4.4.</span> <span class="toc-text">Commonjs 规范和 nodejs 的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exports-%E5%AF%BC%E5%87%BA"><span class="toc-number">4.5.</span> <span class="toc-text">exports 导出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#require-%E7%BB%86%E8%8A%82"><span class="toc-number">4.6.</span> <span class="toc-text">require 细节</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number">4.7.</span> <span class="toc-text">模块的加载过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Commonjs-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%A7%84%E8%8C%83%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">4.8.</span> <span class="toc-text">Commonjs 模块化规范的缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AMD-%E8%A7%84%E8%8C%83"><span class="toc-number">4.9.</span> <span class="toc-text">AMD 规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CMD-%E8%A7%84%E8%8C%83"><span class="toc-number">4.10.</span> <span class="toc-text">CMD 规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86-ESModule"><span class="toc-number">4.11.</span> <span class="toc-text">认识 ESModule</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exports-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">4.12.</span> <span class="toc-text">exports 关键字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#import-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">4.13.</span> <span class="toc-text">import 关键字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#export-%E5%92%8C-import-%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">4.14.</span> <span class="toc-text">export 和 import 结合使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#default-%E7%94%A8%E6%B3%95"><span class="toc-number">4.15.</span> <span class="toc-text">default 用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#import-%E5%87%BD%E6%95%B0"><span class="toc-number">4.16.</span> <span class="toc-text">import 函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES-Module-%E7%9A%84%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B"><span class="toc-number">4.17.</span> <span class="toc-text">ES Module 的解析流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5%E4%B8%80%EF%BC%9A%E6%9E%84%E5%BB%BA%E9%98%B6%E6%AE%B5"><span class="toc-number">4.17.1.</span> <span class="toc-text">阶段一：构建阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B6%E6%AE%B5%E4%BA%8C%E5%92%8C%E4%B8%89%EF%BC%9A%E5%AE%9E%E4%BE%8B%E5%8C%96%E9%98%B6%E6%AE%B5-%E6%B1%82%E5%80%BC%E9%98%B6%E6%AE%B5"><span class="toc-number">4.17.2.</span> <span class="toc-text">阶段二和三：实例化阶段 - 求值阶段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">4.18.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#npm-%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">5.</span> <span class="toc-text">npm 包管理工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%85%B1%E4%BA%AB%E6%96%B9%E6%A1%88"><span class="toc-number">5.1.</span> <span class="toc-text">代码共享方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-npm"><span class="toc-number">5.2.</span> <span class="toc-text">包管理工具 npm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npm-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.3.</span> <span class="toc-text">npm 的配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">5.4.</span> <span class="toc-text">常见的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E7%9A%84%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="toc-number">5.5.</span> <span class="toc-text">依赖的版本管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npm-install-%E5%91%BD%E4%BB%A4"><span class="toc-number">5.6.</span> <span class="toc-text">npm install 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85"><span class="toc-number">5.7.</span> <span class="toc-text">项目安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npm-install-%E5%8E%9F%E7%90%86"><span class="toc-number">5.8.</span> <span class="toc-text">npm install 原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npm-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">5.9.</span> <span class="toc-text">npm 其他命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yarn-%E5%B7%A5%E5%85%B7"><span class="toc-number">5.10.</span> <span class="toc-text">yarn 工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cnpm-%E5%B7%A5%E5%85%B7"><span class="toc-number">5.11.</span> <span class="toc-text">cnpm 工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npx-%E5%B7%A5%E5%85%B7"><span class="toc-number">5.12.</span> <span class="toc-text">npx 工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E5%91%BD%E4%BB%A4%E7%9A%84%E6%89%A7%E8%A1%8C"><span class="toc-number">5.13.</span> <span class="toc-text">局部命令的执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npm-%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8C%85"><span class="toc-number">5.14.</span> <span class="toc-text">npm 发布自己的包</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JSON-storage"><span class="toc-number">6.</span> <span class="toc-text">JSON-storage</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON-%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="toc-number">6.1.</span> <span class="toc-text">JSON 的由来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">6.2.</span> <span class="toc-text">JSON基本语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">6.3.</span> <span class="toc-text">JSON 的序列化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stringify-%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">6.4.</span> <span class="toc-text">Stringify 的参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parse%E6%96%B9%E6%B3%95"><span class="toc-number">6.5.</span> <span class="toc-text">parse方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JSON-%E8%BF%9B%E8%A1%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="toc-number">6.6.</span> <span class="toc-text">使用 JSON 进行深拷贝</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86Storage"><span class="toc-number">6.7.</span> <span class="toc-text">认识Storage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#localStorage-%E5%92%8C-sessionStorage-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.8.</span> <span class="toc-text">localStorage 和 sessionStorage 的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Storage%E5%B8%B8%E8%A7%81%E7%9A%84%E6%96%B9%E6%B3%95%E5%92%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">6.9.</span> <span class="toc-text">Storage常见的方法和属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Storage-%E5%B7%A5%E5%85%B7%E5%BA%93%E7%9A%84%E5%B0%81%E8%A3%85"><span class="toc-number">6.10.</span> <span class="toc-text">Storage 工具库的封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86-IndexDB"><span class="toc-number">6.11.</span> <span class="toc-text">认识 IndexDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IndexdDB-%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">6.12.</span> <span class="toc-text">IndexdDB 连接数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IndexDB-%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">6.13.</span> <span class="toc-text">IndexDB 的数据库操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cookie-DOM-BOM"><span class="toc-number">7.</span> <span class="toc-text">Cookie-DOM-BOM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86Cookie"><span class="toc-number">7.1.</span> <span class="toc-text">认识Cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookie-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">7.2.</span> <span class="toc-text">cookie 常见的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BE%E7%BD%AE-Cookie"><span class="toc-number">7.3.</span> <span class="toc-text">客户端设置 Cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie-%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">7.4.</span> <span class="toc-text">Cookie 的缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86BOM"><span class="toc-number">7.5.</span> <span class="toc-text">认识BOM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Window-%E7%AA%97%E5%8F%A3%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.6.</span> <span class="toc-text">Window 窗口对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#window-%E5%B8%B8%E8%A7%81%E5%B1%9E%E6%80%A7"><span class="toc-number">7.6.1.</span> <span class="toc-text">window 常见属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#window-%E5%B8%B8%E8%A7%81%E6%96%B9%E6%B3%95"><span class="toc-number">7.6.2.</span> <span class="toc-text">window 常见方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#window-%E5%B8%B8%E8%A7%81%E4%BA%8B%E4%BB%B6"><span class="toc-number">7.6.3.</span> <span class="toc-text">window 常见事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EventTarget"><span class="toc-number">7.6.4.</span> <span class="toc-text">EventTarget</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Location-%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.7.</span> <span class="toc-text">Location 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Location-%E5%AF%B9%E8%B1%A1%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">7.7.1.</span> <span class="toc-text">Location 对象常见的属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Location-%E5%AF%B9%E8%B1%A1%E5%B8%B8%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">7.7.2.</span> <span class="toc-text">Location 对象常用的方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#History-%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.8.</span> <span class="toc-text">History 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86-DOM-%E5%92%8C%E6%9E%B6%E6%9E%84"><span class="toc-number">7.9.</span> <span class="toc-text">认识 DOM 和架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-%E8%8A%82%E7%82%B9"><span class="toc-number">7.10.</span> <span class="toc-text">Node 节点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Document"><span class="toc-number">7.11.</span> <span class="toc-text">Document</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Element"><span class="toc-number">7.12.</span> <span class="toc-text">Element</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="toc-number">7.13.</span> <span class="toc-text">认识事件监听</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86%E4%BA%8B%E4%BB%B6%E6%B5%81%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="toc-number">7.14.</span> <span class="toc-text">认识事件流的由来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1%E5%92%8C%E4%BA%8B%E4%BB%B6%E6%8D%95%E8%8E%B7"><span class="toc-number">7.15.</span> <span class="toc-text">事件冒泡和事件捕获</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1-event"><span class="toc-number">7.16.</span> <span class="toc-text">事件对象 event</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%98%B2%E6%8A%96-%E8%8A%82%E6%B5%81-%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF"><span class="toc-number">8.</span> <span class="toc-text">防抖-节流-深拷贝-事件总线</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E6%8A%96"><span class="toc-number">8.1.</span> <span class="toc-text">防抖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%82%E6%B5%81"><span class="toc-number">8.2.</span> <span class="toc-text">节流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="toc-number">8.3.</span> <span class="toc-text">深拷贝</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF"><span class="toc-number">8.4.</span> <span class="toc-text">自定义事件总线</span></a></li></ol></li></ol></div></div></div><div class="tag-cloud"><div class="tag-cloud-tags"><a href="/tags/JavaScript/" style="font-size: 27px; color: #8cbbd1">JavaScript</a> <a href="/tags/React/" style="font-size: 24px; color: #8dbad0">React</a> <a href="/tags/TypeScript/" style="font-size: 15px; color: #92b6cf">TypeScript</a> <a href="/tags/Vite/" style="font-size: 12px; color: #93b5cf">Vite</a> <a href="/tags/Vue/" style="font-size: 30px; color: #8abcd1">Vue</a> <a href="/tags/Vue3/" style="font-size: 15px; color: #92b6cf">Vue3</a> <a href="/tags/Webpack/" style="font-size: 15px; color: #92b6cf">Webpack</a> <a href="/tags/eggjs/" style="font-size: 18px; color: #90b7d0">eggjs</a> <a href="/tags/serverless/" style="font-size: 18px; color: #90b7d0">serverless</a> <a href="/tags/uniapp/" style="font-size: 21px; color: #8fb9d0">uniapp</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 15px; color: #92b6cf">小程序</a> <a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 15px; color: #92b6cf">工程化</a> <a href="/tags/%E6%97%A5%E8%AE%B0/" style="font-size: 12px; color: #93b5cf">日记</a> <a href="/tags/%E6%97%A5%E8%AF%AD/" style="font-size: 12px; color: #93b5cf">日语</a> <a href="/tags/%E6%A6%82%E5%BF%B5/" style="font-size: 21px; color: #8fb9d0">概念</a> <a href="/tags/%E9%83%A8%E7%BD%B2/" style="font-size: 12px; color: #93b5cf">部署</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 15px; color: #92b6cf">面试</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 15px; color: #92b6cf">项目</a></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://xxcijmz.top/blogs/6af01b42/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="语轻星子"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="轻语馆"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">CodeWhy-JavaScript高级-学习笔记2</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2022-02-07 14:55:34" itemprop="dateCreated datePublished" datetime="2022-02-07T14:55:34+08:00">2022-02-07</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2022-02-14 13:11:22" itemprop="dateModified" datetime="2022-02-14T13:11:22+08:00">2022-02-14</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="本文字数">26.9k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="阅读时长">110m</span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/CodeWhy/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">CodeWhy</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/CodeWhy/JavaScript/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">JavaScript</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/JavaScript/" style="--text-color:#F4DF4F"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">JavaScript</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#5698c3;"><h1 id="Iterator-generator"><a href="#Iterator-generator" class="headerlink" title="Iterator - generator"></a>Iterator - generator</h1><h2 id="什么是迭代器？"><a href="#什么是迭代器？" class="headerlink" title="什么是迭代器？"></a>什么是迭代器？</h2><ul>
<li><p><strong>迭代器</strong>（iterator），是确使用户可在容器对象（container，例如链表或数组）上遍访的对象，使用该接口无需关心对象的内部实现细节。（迭代器本身就是一个对象，这个对象可以帮助我们遍历另外一个容器对象）</p>
<ul>
<li><p>其行为像数据库中的光标，迭代器最早出现在1974年设计的CLU编程语言中；</p>
</li>
<li><p>在各种编程语言的实现中，迭代器的实现方式各不相同，但是基本都有迭代器，比如Java、Python等；</p>
</li>
</ul>
</li>
<li><p>从迭代器的定义我们可以看出来，迭代器是帮助我们对某个数据结构进行遍历的对象。</p>
</li>
<li><p>在JavaScript中，迭代器也是一个具体的对象，这个对象需要符合<code>迭代器协议</code>（iterator protocol）：</p>
<ul>
<li><p>迭代器协议定义了产生一系列值（无论是有限还是无限个）的标准方式；</p>
</li>
<li><p>那么在js中这个标准就是一个特定的next方法；</p>
</li>
</ul>
</li>
<li><p>next方法有如下的要求：</p>
<ul>
<li>一个无参数或者一个参数的函数，返回一个应当拥有以下两个属性的对象：</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>done<span class="token operator">:</span><span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span> <span class="token punctuation">,</span> value<span class="token operator">:</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<ul>
<li><p><strong>done（boolean）</strong> </p>
<ul>
<li><p>如果迭代器可以产生序列中的下一个值，则为 false。（这等价于没有指定 done 这个属性。）</p>
</li>
<li><p>如果迭代器已将序列迭代完毕，则为 true。这种情况下，value 是可选的，如果它依然存在，即为迭代结束之后的默认返回值。</p>
</li>
</ul>
</li>
<li><p><strong>value</strong></p>
<ul>
<li>迭代器返回的任何value值。done 为 true 时可省略done。(最后一次可以省略done:true)</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 编写的一个迭代器</span>
<span class="token keyword">const</span> iterator <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 数组</span>
<span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token string">"cba"</span><span class="token punctuation">,</span> <span class="token string">"nba"</span><span class="token punctuation">]</span>

<span class="token comment">// 创建一个迭代器对象来访问数组</span>
<span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">const</span> namesIterator <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> names<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> names<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &#123; done: false, value: "nba" &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &#123; done: true, value: undefined &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &#123; done: true, value: undefined &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &#123; done: true, value: undefined &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p><strong>生成迭代器的函数：</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createArrayIterator</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> arr<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token string">"cba"</span><span class="token punctuation">,</span> <span class="token string">"nba"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> namesIterator <span class="token operator">=</span> <span class="token function">createArrayIterator</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> numsIterator <span class="token operator">=</span> <span class="token function">createArrayIterator</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numsIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numsIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numsIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numsIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个无限的迭代器</span>
<span class="token keyword">function</span> <span class="token function">createNumberIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> index<span class="token operator">++</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> numberInterator <span class="token operator">=</span> <span class="token function">createNumberIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberInterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<h2 id="可迭代对象"><a href="#可迭代对象" class="headerlink" title="可迭代对象"></a>可迭代对象</h2><ul>
<li><p>但是上面的代码整体来说看起来是有点奇怪的：</p>
<ul>
<li><p>我们获取一个数组的时候，需要自己创建一个index变量，再创建一个所谓的迭代器对象；</p>
</li>
<li><p>事实上我们可以对上面的代码进行进一步的封装，让其变成一个可迭代对象；</p>
</li>
</ul>
</li>
<li><p>什么又是可迭代对象呢？</p>
<ul>
<li><p>它和迭代器是不同的概念；</p>
</li>
<li><p>当一个对象实现了iterable protocol协议时，它就是一个可迭代对象；</p>
</li>
<li><p>这个对象的要求是必须实现 @@iterator 方法，在代码中我们使用 Symbol.iterator 访问该属性；</p>
</li>
</ul>
</li>
<li><p>当我们要问一个问题，我们转成这样的一个东西有什么好处呢？</p>
<ul>
<li>当一个对象变成一个可迭代对象的时候，进行某些迭代操作，比如 for…of 操作时，其实就会调用它的@@iterator 方法；</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建一个迭代器对象来访问数组</span>
<span class="token keyword">const</span> iterableObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  names<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token string">"cba"</span><span class="token punctuation">,</span> <span class="token string">"nba"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 此处的 [Symbol.iterator] 为可计算属性</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 注意此处需要使用箭头函数</span>
      <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 注意此处需要使用 this.names</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>names<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>names<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// iterableObj对象就是一个可迭代对象</span>
<span class="token comment">// console.log(iterableObj[Symbol.iterator])</span>

<span class="token comment">// 1.第一次调用iterableObj[Symbol.iterator]函数</span>
<span class="token keyword">const</span> iterator <span class="token operator">=</span> iterableObj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// // 2.第二次调用iterableObj[Symbol.iterator]函数</span>
<span class="token keyword">const</span> iterator1 <span class="token operator">=</span> iterableObj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3.for...of可以遍历的东西必须是一个可迭代对象，可以将其看做上方 iterator.next() 的语法糖</span>
<span class="token comment">// const obj = &#123;</span>
<span class="token comment">//   name: "why",</span>
<span class="token comment">//   age: 18</span>
<span class="token comment">// &#125;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> iterableObj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="元素可迭代对象"><a href="#元素可迭代对象" class="headerlink" title="元素可迭代对象"></a>元素可迭代对象</h2><ul>
<li>事实上我们平时创建的很多原生对象已经实现了可迭代协议，会生成一个迭代器对象的：<ul>
<li>String、Array、Map、Set、arguments对象、NodeList集合；</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token string">"cba"</span><span class="token punctuation">,</span> <span class="token string">"nba"</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>names<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// const iterator1 = names[Symbol.iterator]()</span>
<span class="token comment">// console.log(iterator1.next())</span>
<span class="token comment">// console.log(iterator1.next())</span>
<span class="token comment">// console.log(iterator1.next())</span>
<span class="token comment">// console.log(iterator1.next())</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> names<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Map/Set</span>
<span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> set<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 函数中arguments也是一个可迭代对象</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> arg <span class="token keyword">of</span> arguments<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span></code></pre>



<h2 id="可迭代对象的应用场景"><a href="#可迭代对象的应用场景" class="headerlink" title="可迭代对象的应用场景"></a>可迭代对象的应用场景</h2><ul>
<li><p>那么这些东西可以被用在哪里呢？</p>
<ul>
<li><p>JavaScript中语法：for …of、展开语法（spread syntax）、yield*（后面讲）、解构赋值（Destructuring_assignment）；</p>
</li>
<li><p>创建一些对象时：new Map([Iterable])、new WeakMap([iterable])、new Set([iterable])、new WeakSet([iterable]);</p>
</li>
<li><p>一些方法的调用：Promise.all(iterable)、Promise.race(iterable)、Array.from(iterable);</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1.for of场景</span>

<span class="token comment">// 2.展开语法(spread syntax)</span>
<span class="token keyword">const</span> iterableObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  names<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token string">"cba"</span><span class="token punctuation">,</span> <span class="token string">"nba"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>names<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>names<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token string">"cba"</span><span class="token punctuation">,</span> <span class="token string">"nba"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newNames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>names<span class="token punctuation">,</span> <span class="token operator">...</span>iterableObj<span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newNames<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 'abc', 'cba', 'nba', 'abc', 'cba', 'nba' ]</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"why"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// for (const item of obj) &#123;</span>

<span class="token comment">// &#125;</span>
<span class="token comment">// obj 本身是不可迭代的，但是却可以像下面这样解构使用：</span>
<span class="token comment">// 这是因为其是ES9(ES2018)中新增的一个特性: 用的不是迭代器</span>
<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>obj <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3.解构语法</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">]</span> <span class="token operator">=</span> names<span class="token punctuation">;</span>
<span class="token comment">// const &#123; name, age &#125; = obj 与上方不一样，其是ES9新增的特性</span>

<span class="token comment">// 4.创建一些其他对象时</span>
<span class="token keyword">const</span> set1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>iterableObj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// new Set() 要求传入一个可迭代对象</span>
<span class="token keyword">const</span> set2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> arr1 <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>iterableObj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 5.Promise.all</span>
<span class="token comment">// Promise.all 要求传入一个可迭代对象</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>iterableObj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<h2 id="自定义类的迭代"><a href="#自定义类的迭代" class="headerlink" title="自定义类的迭代"></a>自定义类的迭代</h2><ul>
<li><p>在前面我们看到Array、Set、String、Map等类创建出来的对象都是可迭代对象：</p>
<ul>
<li><p>在面向对象开发中，我们可以通过class定义一个自己的类，这个类可以创建很多的对象：</p>
</li>
<li><p>如果我们也希望自己的类创建出来的对象默认是可迭代的，那么在设计类的时候我们就可以添加上@@iterator 方法；</p>
</li>
</ul>
</li>
<li><p>案例：创建一个classroom的类</p>
<ul>
<li><p>教室中有自己的位置、名称、当前教室的学生；</p>
</li>
<li><p>这个教室可以进来新学生（push）；</p>
</li>
<li><p>创建的教室对象是可迭代对象；</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>迭代器在某些情况下会在没有完全迭代的情况下中断：</p>
<ul>
<li><p>比如遍历的过程中通过break、continue、return、throw中断了循环操作；</p>
</li>
<li><p>比如在解构的时候，没有解构所有的值；</p>
</li>
</ul>
</li>
<li><p>那么这个时候我们想要监听中断的话，可以添加return方法：</p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 案例: 创建一个教室类, 创建出来的对象都是可迭代对象</span>
<span class="token keyword">class</span> <span class="token class-name">Classroom</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">address<span class="token punctuation">,</span> name<span class="token punctuation">,</span> students</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>students <span class="token operator">=</span> students<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">entry</span><span class="token punctuation">(</span><span class="token parameter">newStudent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newStudent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>students<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>students<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token function-variable function">return</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// return 可以监听 break。</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"迭代器提前终止了~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> done<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// return 函数要求也要 return 一个值</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> classroom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Classroom</span><span class="token punctuation">(</span><span class="token string">"3幢5楼205"</span><span class="token punctuation">,</span> <span class="token string">"计算机教室"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token string">"james"</span><span class="token punctuation">,</span>
  <span class="token string">"kobe"</span><span class="token punctuation">,</span>
  <span class="token string">"curry"</span><span class="token punctuation">,</span>
  <span class="token string">"why"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
classroom<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">"lilei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> stu <span class="token keyword">of</span> classroom<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>stu <span class="token operator">===</span> <span class="token string">"why"</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// 若使用 function 创造出一个对象，可以使用下面的方式为其添加可迭代方法</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h2 id="什么是生成器"><a href="#什么是生成器" class="headerlink" title="什么是生成器"></a>什么是生成器</h2><ul>
<li><p>生成器是ES6中新增的一种函数控制、使用的方案，它可以让我们更加灵活的控制函数什么时候继续执行、暂停执行等。</p>
</li>
<li><p>平时我们会编写很多的函数，这些函数终止的条件通常是返回值或者发生了异常。</p>
</li>
<li><p><strong>生成器函数也是一个函数，但是和普通的函数有一些区别：</strong> </p>
<ul>
<li><p>首先，生成器函数需要在function的后面加一个符号：* </p>
</li>
<li><p>其次，生成器函数可以通过yield关键字来控制函数的执行流程： </p>
</li>
<li><p>最后，生成器函数的返回值是一个Generator（生成器）：</p>
<ul>
<li><p>生成器事实上是一种特殊的迭代器；</p>
</li>
<li><p> MDN：Instead, they return a special type of iterator, called a <strong>Generator</strong>.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"函数开始执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> value1 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第一段代码:"</span><span class="token punctuation">,</span> value1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> value2 <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第二段代码:"</span><span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> value3 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第三段代码:"</span><span class="token punctuation">,</span> value3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"函数执行结束~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 调用生成器函数时, 会给我们返回一个生成器对象，而函数本身是一行都不会执行的。</span>
<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 开始执行第一段（第一个 yield之前的）代码</span>
generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 开始执行第二段代码</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"-------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"----------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/58.jpg" loading="lazy"></p>
<h2 id="生成器函数执行"><a href="#生成器函数执行" class="headerlink" title="生成器函数执行"></a>生成器函数执行</h2><ul>
<li><p>我们发现上面的生成器函数foo的执行体压根没有执行，它只是返回了一个生成器对象。</p>
<ul>
<li><p>那么我们如何可以让它执行函数中的东西呢？调用next即可； </p>
</li>
<li><p>我们之前学习迭代器时，知道迭代器的next是会有返回值的；</p>
</li>
<li><p>但是我们很多时候不希望next返回的是一个undefined，这个时候我们可以通过yield来返回结果；</p>
</li>
<li><p>生成器函数返回的生成器对象执行 next() 函数时，若之后没有yield 了，会执行完函数剩余的所有代码，并返回一个<code>&#123;done:true，value:undefined&#125;</code>。我们也可以使用 return 来提前返回。</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 当遇到yield时候值暂停函数的执行</span>
<span class="token comment">// 当遇到return时候生成器就停止执行</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"函数开始执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> value1 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第一段代码:"</span><span class="token punctuation">,</span> value1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> value1<span class="token punctuation">;</span>

  <span class="token keyword">const</span> value2 <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第二段代码:"</span><span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> value2<span class="token punctuation">;</span>

  <span class="token keyword">const</span> value3 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第三段代码:"</span><span class="token punctuation">,</span> value3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> value3<span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"函数执行结束~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">"123"</span><span class="token punctuation">;</span> <span class="token comment">// 此处的返回值会作为最后一次 next 的 value,同时 return 会使 done 变为 true</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// generator本质上是一个特殊的iterator</span>
<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"返回值1:"</span><span class="token punctuation">,</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回值1: &#123; value: 100, done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"返回值2:"</span><span class="token punctuation">,</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回值2: &#123; value: 200, done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"返回值3:"</span><span class="token punctuation">,</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回值3: &#123; value: 300, done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"返回值3:"</span><span class="token punctuation">,</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回值3: &#123; value: '123', done: true &#125;</span></code></pre>

<h2 id="生成器传递参数-–-next函数"><a href="#生成器传递参数-–-next函数" class="headerlink" title="生成器传递参数 – next函数"></a>生成器传递参数 – next函数</h2><ul>
<li><p>函数既然可以暂停来分段执行，那么函数应该是可以传递参数的，我们是否可以给每个分段来传递参数呢？</p>
<ul>
<li><p>答案是可以的；</p>
</li>
<li><p>我们在调用next函数的时候，可以给它传递参数，那么这个参数会作为上一个yield语句的返回值；</p>
</li>
<li><p>注意：也就是说我们是为本次的函数代码块执行提供了一个值；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"函数开始执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> value1 <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> num<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第一段代码:"</span><span class="token punctuation">,</span> value1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token keyword">yield</span> value1<span class="token punctuation">;</span> <span class="token comment">// next 中传入的参数会作为上一次 yield 的返回值</span>

  <span class="token keyword">const</span> value2 <span class="token operator">=</span> <span class="token number">200</span> <span class="token operator">*</span> n<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第二段代码:"</span><span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">yield</span> value2<span class="token punctuation">;</span>

  <span class="token keyword">const</span> value3 <span class="token operator">=</span> <span class="token number">300</span> <span class="token operator">*</span> count<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第三段代码:"</span><span class="token punctuation">,</span> value3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> value3<span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"函数执行结束~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">"123"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 生成器上的next方法可以传递参数(从第二个next 开始，第一个next 一般不传)</span>
<span class="token comment">// 若想要给第一个 yield 之前的代码传值，一般会在 函数 调用时传参。</span>
<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: 500, done: false &#125;</span>
<span class="token comment">// 第二段代码, 第二次调用next的时候执行的</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: 2000, done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: 7500, done: false &#125;</span></code></pre>

<h2 id="生成器提前结束-–-return函数"><a href="#生成器提前结束-–-return函数" class="headerlink" title="生成器提前结束 – return函数"></a>生成器提前结束 – return函数</h2><ul>
<li>还有一个可以给生成器函数传递参数的方法是通过return函数：<ul>
<li>return传值后这个生成器函数就会结束，之后调用next不会继续生成值了；</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"函数开始执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> value1 <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> num<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第一段代码:"</span><span class="token punctuation">,</span> value1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token keyword">yield</span> value1<span class="token punctuation">;</span>

  <span class="token keyword">const</span> value2 <span class="token operator">=</span> <span class="token number">200</span> <span class="token operator">*</span> n<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第二段代码:"</span><span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">yield</span> value2<span class="token punctuation">;</span>

  <span class="token keyword">const</span> value3 <span class="token operator">=</span> <span class="token number">300</span> <span class="token operator">*</span> count<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第三段代码:"</span><span class="token punctuation">,</span> value3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> value3<span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"函数执行结束~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">"123"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: 1000, done: false &#125;</span>

<span class="token comment">// 第二段代码的执行, 使用了return</span>
<span class="token comment">// 那么就意味着相当于在第一段代码的后面加上return n, 就会提前终端生成器函数代码继续执行</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">return</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: 15, done: true &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: undefined, done: true &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: undefined, done: true &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: undefined, done: true &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: undefined, done: true &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: undefined, done: true &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: undefined, done: true &#125;</span></code></pre>

<h2 id="生成器抛出异常-–-throw函数"><a href="#生成器抛出异常-–-throw函数" class="headerlink" title="生成器抛出异常 – throw函数"></a>生成器抛出异常 – throw函数</h2><ul>
<li>除了给生成器函数内部传递参数之外，也可以给生成器函数内部抛出异常：<ul>
<li>抛出异常后我们可以在生成器函数中捕获异常；</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"代码开始执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> value1 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">yield</span> value1<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"捕获到异常情况:"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 捕获到异常情况: error message</span>

    <span class="token keyword">yield</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"第二段代码继续执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> value2 <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> value2<span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"代码执行结束~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 应用场景：当我们获取到 result 不满意时，可以使用 generator.throw 终止函数执行（前提是函数没有trycatch捕获异常）</span>
<span class="token comment">// 此处的异常会在函数的 yield 中触发</span>
<span class="token comment">/*
if(result.value !== 200)&#123;
  console.log(generator.throw("error message"))
&#125;
*/</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">"error message"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: 'abc', done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: 200, done: false &#125;</span></code></pre>

<h2 id="生成器替代迭代器使用"><a href="#生成器替代迭代器使用" class="headerlink" title="生成器替代迭代器使用"></a>生成器替代迭代器使用</h2><ul>
<li><p>我们发现生成器是一种特殊的迭代器，那么在某些情况下我们可以使用生成器来替代迭代器： </p>
</li>
<li><p>同时我们还可以使用yield*来生产一个可迭代对象：</p>
<ul>
<li>这个时候相当于是一种yield的语法糖，只不过会依次迭代这个可迭代对象，每次迭代其中的一个值；</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 迭代器写法</span>
<span class="token comment">// function createArrayIterator(arr) &#123;</span>
<span class="token comment">//   let index = 0;</span>
<span class="token comment">//   return &#123;</span>
<span class="token comment">//     next: function () &#123;</span>
<span class="token comment">//       if (index &lt; arr.length) &#123;</span>
<span class="token comment">//         return &#123; done: false, value: arr[index++] &#125;;</span>
<span class="token comment">//       &#125; else &#123;</span>
<span class="token comment">//         return &#123; done: true, value: undefined &#125;;</span>
<span class="token comment">//       &#125;</span>
<span class="token comment">//     &#125;,</span>
<span class="token comment">//   &#125;;</span>
<span class="token comment">// &#125;</span>

<span class="token comment">// 1.生成器来替代迭代器</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">createArrayIterator</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 3.第三种写法 yield*</span>
  <span class="token keyword">yield</span><span class="token operator">*</span> arr<span class="token punctuation">;</span> <span class="token comment">// 这个时候相当于是一种yield的语法糖，只不过会依次迭代这个可迭代对象，每次迭代其中的一个值；</span>
  <span class="token comment">// 2.第二种写法</span>
  <span class="token comment">// for (const item of arr) &#123;</span>
  <span class="token comment">//   yield item;</span>
  <span class="token comment">// &#125;</span>
  <span class="token comment">// 1.第一种写法</span>
  <span class="token comment">// let index = 0;</span>
  <span class="token comment">// yield arr[index++] // &#123; done: false, value: "abc" &#125;</span>
  <span class="token comment">// yield arr[index++] // &#123; done: false, value: "cba" &#125;</span>
  <span class="token comment">// yield arr[index++] // &#123; done: false, value: "nba" &#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token string">"cba"</span><span class="token punctuation">,</span> <span class="token string">"nba"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> namesIterator <span class="token operator">=</span> <span class="token function">createArrayIterator</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>namesIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2.创建一个函数, 这个函数可以迭代一个范围内的数字</span>
<span class="token comment">// 10 20</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">createRangeIterator</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> start<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">yield</span> index<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// let index = start</span>
  <span class="token comment">// return &#123;</span>
  <span class="token comment">//   next: function() &#123;</span>
  <span class="token comment">//     if (index &lt; end) &#123;</span>
  <span class="token comment">//       return &#123; done: false, value: index++ &#125;</span>
  <span class="token comment">//     &#125; else &#123;</span>
  <span class="token comment">//       return &#123; done: true, value: undefined &#125;</span>
  <span class="token comment">//     &#125;</span>
  <span class="token comment">//   &#125;</span>
  <span class="token comment">// &#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> rangeIterator <span class="token operator">=</span> <span class="token function">createRangeIterator</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rangeIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rangeIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rangeIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rangeIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rangeIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h2 id="自定义类迭代-–-生成器实现"><a href="#自定义类迭代-–-生成器实现" class="headerlink" title="自定义类迭代 – 生成器实现"></a>自定义类迭代 – 生成器实现</h2><ul>
<li>在之前的自定义类迭代中，我们也可以换成生成器：</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Classroom</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">address<span class="token punctuation">,</span> name<span class="token punctuation">,</span> students</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>students <span class="token operator">=</span> students<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">entry</span><span class="token punctuation">(</span><span class="token parameter">newStudent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newStudent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 需要注意：class 中的方法需要使用 = 来赋值，而不可以使用 :</span>
  <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token comment">// [Symbol.iterator] = function*() &#123;</span>
  <span class="token comment">//   yield* this.students</span>
  <span class="token comment">// &#125;</span>

  <span class="token operator">*</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>students<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> classroom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Classroom</span><span class="token punctuation">(</span><span class="token string">"3幢"</span><span class="token punctuation">,</span> <span class="token string">"1102"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token string">"cba"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> classroom<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>





<h2 id="异步处理方案"><a href="#异步处理方案" class="headerlink" title="异步处理方案"></a>异步处理方案</h2><ul>
<li><p>学完了我们前面的Promise、生成器等，我们目前来看一下异步代码的最终处理方案。</p>
</li>
<li><p>需求：</p>
<ul>
<li><p>我们需要向服务器发送网络请求获取数据，一共需要发送三次请求；</p>
</li>
<li><p>第二次的请求url依赖于第一次的结果；</p>
</li>
<li><p>第三次的请求url依赖于第二次的结果；</p>
</li>
<li><p>依次类推；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// request.js</span>
<span class="token keyword">function</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 异步请求的代码会被放入到executor中</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 模拟网络请求</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 拿到请求的结果</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1.第一种方案: 多次回调</span>
<span class="token comment">// 回调地狱</span>
<span class="token function">requestData</span><span class="token punctuation">(</span><span class="token string">"why"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">requestData</span><span class="token punctuation">(</span>res <span class="token operator">+</span> <span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">requestData</span><span class="token punctuation">(</span>res <span class="token operator">+</span> <span class="token string">"bbb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 2.第二种方案: Promise中then的返回值来解决</span>
<span class="token function">requestData</span><span class="token punctuation">(</span><span class="token string">"why"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">requestData</span><span class="token punctuation">(</span>res <span class="token operator">+</span> <span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">requestData</span><span class="token punctuation">(</span>res <span class="token operator">+</span> <span class="token string">"bbb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<ul>
<li>上面的代码看起来也是阅读性比较差的，有没有办法可以继续来对上面的代码进行优化呢？</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 3.第三种方案: Promise + generator实现</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token string">"why"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">requestData</span><span class="token punctuation">(</span>res1 <span class="token operator">+</span> <span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">requestData</span><span class="token punctuation">(</span>res2 <span class="token operator">+</span> <span class="token string">"bbb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res4 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">requestData</span><span class="token punctuation">(</span>res3 <span class="token operator">+</span> <span class="token string">"ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<ul>
<li><p>我们上面的写法有两个问题：</p>
<ul>
<li><p>第一，我们不能确定到底需要调用几层的Promise关系； </p>
</li>
<li><p>第二，如果还有其他需要这样执行的函数，我们应该如何操作呢？</p>
</li>
</ul>
</li>
<li><p>所以，我们可以封装一个工具函数execGenerator自动执行生成器函数：</p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">execGenerator</span><span class="token punctuation">(</span><span class="token parameter">genFn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">genFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    result<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">exec</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">execGenerator</span><span class="token punctuation">(</span>getData<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<ul>
<li>此外，我们还可以使用第三方库来实现同样效果：</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> co <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"co"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">co</span><span class="token punctuation">(</span>getData<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<ul>
<li>然而最优解仍是使用 async/await，其还不需要我们手动去获取返回值。</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token string">"why"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestData</span><span class="token punctuation">(</span>res1 <span class="token operator">+</span> <span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestData</span><span class="token punctuation">(</span>res2 <span class="token operator">+</span> <span class="token string">"bbb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res4 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestData</span><span class="token punctuation">(</span>res3 <span class="token operator">+</span> <span class="token string">"ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<h1 id="async-await-事件循环"><a href="#async-await-事件循环" class="headerlink" title="async - await - 事件循环"></a>async - await - 事件循环</h1><h2 id="异步函数-async-function"><a href="#异步函数-async-function" class="headerlink" title="异步函数 async function"></a>异步函数 async function</h2><ul>
<li><p>async关键字用于声明一个异步函数：</p>
<ul>
<li><p>async是asynchronous单词的缩写，异步、非同步；</p>
</li>
<li><p>sync是synchronous单词的缩写，同步、同时；</p>
</li>
</ul>
</li>
<li><p>async异步函数可以有很多中写法：</p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// await/async</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">foo2</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">foo3</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">async</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h2 id="异步函数的执行流程"><a href="#异步函数的执行流程" class="headerlink" title="异步函数的执行流程"></a>异步函数的执行流程</h2><ul>
<li>异步函数的内部代码执行过程和普通的函数是一致的，默认情况下也是会被同步执行。</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function start~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"内部的代码执行1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"内部的代码执行2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"内部的代码执行3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function end~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"script start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异步函数的执行顺序，大多数是跟普通函数一样的</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"script end"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p><strong>执行结果：</strong></p>
<pre class="language-none"><code class="language-none">script start
foo function start~
内部的代码执行1    
内部的代码执行2    
内部的代码执行3    
foo function end~  
script end</code></pre>

<ul>
<li><p><strong>异步函数有返回值时，和普通函数会有区别：</strong></p>
<ul>
<li>情况一：异步函数也可以有返回值，但是异步函数的返回值会被包裹到Promise.resolve中；</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function start~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"中间代码~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function end~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">"哈哈哈"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 异步函数的返回值一定是一个Promise</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"promise then function exec:"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-none"><code class="language-none">foo function start~
中间代码~
foo function end~
promise then function exec: 哈哈哈</code></pre>

<ul>
<li>情况二：如果我们的异步函数的返回值是Promise，Promise.resolve的状态会由Promise决定；</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function start~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"中间代码~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function end~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"hehehehe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 异步函数的返回值一定是一个Promise</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"promise then function exec:"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-none"><code class="language-none">foo function start~
中间代码~
foo function end~
promise then function exec: hehehehe</code></pre>

<ul>
<li>情况三：如果我们的异步函数的返回值是一个对象并且实现了thenable，那么会由对象的then方法来决定；</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function start~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"中间代码~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function end~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">then</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"hahahah"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"promise then function exec:"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-none"><code class="language-none">foo function start~
中间代码~
foo function end~
promise then function exec: hahahah</code></pre></li>
<li><p>如果我们在async中抛出了异常，那么程序它并不会像普通函数一样报错，而是会作为Promise的reject来传递；</p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function start~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"中间代码~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 异步函数中的异常, 会被作为异步函数返回的Promise的reject值的</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"error message"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function end~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 这段代码不会执行</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 异步函数的返回值一定是一个Promise</span>
<span class="token comment">// Promise 在有异常的情况下，必须用 catch 进行捕获，否则会在 node 中报错</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"coderwhy err:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后续还有代码~~~~~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-none"><code class="language-none">foo function start~
中间代码~
后续还有代码~~~~~
coderwhy err: Error: error message
    at foo (D:\寒假修炼\课堂资料day01_32【海量资源：666java.com】\课堂\code\27_async-await\04_和普通函数的区别二-异常.js:7:9)
    at Object.&lt;anonymous&gt; (D:\寒假修炼\课堂资料day01_32【海量资源：666java.com】\课堂\code\27_async-await\04_和普通函数的区别二-异常.js:14:1)        
    at Module._compile (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:1072:14)
    at Object.Module._extensions..js (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:1101:10)
    at Module.load (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:937:32)
    at Function.Module._load (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:778:12)
    at Function.executeUserEntryPoint [as runMain] (internal&#x2F;modules&#x2F;run_main.js:76:12)
    at internal&#x2F;main&#x2F;run_main_module.js:17:47</code></pre>



<h2 id="await-关键字"><a href="#await-关键字" class="headerlink" title="await 关键字"></a>await 关键字</h2><ul>
<li><p>async函数另外一个特殊之处就是可以在它内部使用await关键字，而普通函数中是不可以的。</p>
</li>
<li><p>await关键字有什么特点呢？</p>
<ul>
<li><p>通常使用await是后面会跟上一个表达式，这个表达式会返回一个Promise； </p>
</li>
<li><p>那么await会等到Promise的状态变成fulfilled状态，之后继续执行异步函数； </p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1.await跟上表达式，返回的结果是表达式中返回Promise的resolve 结果</span>
<span class="token keyword">function</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 下面的代码相当于 Promise.then 中执行的代码</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后面的代码1"</span><span class="token punctuation">,</span> res1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后面的代码2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后面的代码3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"res2后面的代码"</span><span class="token punctuation">,</span> res2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li>
</ul>
</li>
</ul>
<pre class="language-none"><code class="language-none">后面的代码1 222
后面的代码2
后面的代码3
res2后面的代码 222</code></pre>

<ul>
<li>如果await后面是一个普通的值，那么会直接返回这个值； </li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token number">123</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"res1:"</span><span class="token punctuation">,</span> res1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// res1: 123</span></code></pre>

<ul>
<li>如果await后面是一个thenable的对象，那么会根据对象的then方法调用来决定后续的值； </li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">then</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"res1:"</span><span class="token punctuation">,</span> res1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// res1: abc</span></code></pre>

<ul>
<li>如果await后面的表达式，返回的Promise是reject的状态，那么会将这个reject结果直接作为函数的Promise的reject值；函数之后的代码不会继续执行。</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// resolve(222);</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 此处 requestData 返回一个 reject 值，其会作为 foo 返回的 promise 的值，同时下面的代码不会继续执行。</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"res1:"</span><span class="token punctuation">,</span> res1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"err:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-none"><code class="language-none">err: 1111</code></pre>



<h2 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h2><ul>
<li><p><strong>线程和进程是操作系统中的两个概念：</strong></p>
<ul>
<li><p>进程（process）：计算机已经运行的程序，是操作系统管理程序的一种方式；</p>
</li>
<li><p>线程（thread）：操作系统能够运行运算调度的最小单位，通常情况下它被包含在进程中；</p>
</li>
</ul>
</li>
<li><p><strong>听起来很抽象，这里还是给出我的解释：</strong></p>
<ul>
<li><p>进程：我们可以认为，启动一个应用程序，就会默认启动一个进程（也可能是多个进程）；</p>
</li>
<li><p>线程：每一个进程中，都会启动至少一个线程用来执行程序中的代码，这个线程被称之为主线程； </p>
</li>
<li><p>所以我们也可以说进程是线程的容器；</p>
</li>
</ul>
</li>
<li><p><strong>再用一个形象的例子解释：</strong></p>
<ul>
<li><p>操作系统类似于一个大工厂；</p>
</li>
<li><p>工厂中里有很多车间，这个车间就是进程；</p>
</li>
<li><p>每个车间可能有一个以上的工人在工厂，这个工人就是线程；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/1.jpg" loading="lazy"></p>
<h2 id="操作系统的工作方式"><a href="#操作系统的工作方式" class="headerlink" title="操作系统的工作方式"></a>操作系统的工作方式</h2><ul>
<li><p><strong>操作系统是如何做到同时让多个进程（边听歌、边写代码、边查阅资料）同时工作</strong>呢？</p>
<ul>
<li><p>这是因为CPU的运算速度非常快，它可以快速的在多个进程之间迅速的切换； </p>
</li>
<li><p>当我们进程中的线程获取到时间片时，就可以快速执行我们编写的代码； </p>
</li>
<li><p>对于用户来说是感受不到这种快速的切换的；</p>
</li>
</ul>
</li>
<li><p>你可以在Mac的活动监视器或者Windows的资源管理器中查看到很多进程：</p>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/2.jpg" loading="lazy"></p>
<h2 id="浏览器中的-JavaScript-进程"><a href="#浏览器中的-JavaScript-进程" class="headerlink" title="浏览器中的 JavaScript 进程"></a>浏览器中的 JavaScript 进程</h2><ul>
<li><p>我们经常会说<strong>JavaScript是单线程</strong>的，但是<strong>JavaScript的线程应该有自己的容器进程</strong>：浏览器或者Node。 </p>
</li>
<li><p><strong>浏览器是一个进程吗，它里面只有一个线程吗？</strong></p>
<ul>
<li><p>目前多数的浏览器其实都是多进程的，当我们打开一个tab页面时就会开启一个新的进程，这是为了防止一个页 面卡死而造成所有页面无法响应，整个浏览器需要强制退出；</p>
</li>
<li><p>每个进程中又有很多的线程，其中包括执行JavaScript代码的线程； </p>
</li>
</ul>
</li>
<li><p><strong>JavaScript的代码执行是在一个单独的线程中执行的：</strong></p>
<ul>
<li><p>这就意味着JavaScript的代码，在同一个时刻只能做一件事； </p>
</li>
<li><p>如果这件事是非常耗时的，就意味着当前的线程就会被阻塞； </p>
</li>
</ul>
</li>
<li><p><strong>所以真正耗时的操作，实际上并不是由JavaScript线程在执行的：</strong></p>
<ul>
<li><p>浏览器的每个进程是多线程的，那么其他线程可以来完成这个耗时的操作； </p>
</li>
<li><p>比如网络请求、定时器，我们只需要在特定的时候执行应该有的回调即可；</p>
</li>
</ul>
</li>
</ul>
<h2 id="浏览器的事件循环"><a href="#浏览器的事件循环" class="headerlink" title="浏览器的事件循环"></a>浏览器的事件循环</h2><ul>
<li><strong>如果在执行JavaScript代码的过程中，有异步操作呢？</strong><ul>
<li>中间我们插入了一个setTimeout的函数调用；</li>
<li>这个函数被放到入调用栈中（另一个进程），执行会立即结束，并不会阻塞后续代码的执行；</li>
<li>之后当 setTimeout 的时间到达时，将函数加入到事件队列中（由浏览器维护），等主线程的执行代码执行完后，将事件队列中的该函数放入到主线程执行。</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/3.jpg" loading="lazy"></p>
<h2 id="宏任务和微任务"><a href="#宏任务和微任务" class="headerlink" title="宏任务和微任务"></a>宏任务和微任务</h2><ul>
<li><p><strong>但是事件循环中并非只维护着一个队列，事实上是有两个队列：</strong></p>
<ul>
<li><p>宏任务队列（macrotask queue）：ajax、setTimeout、setInterval、DOM监听、UI Rendering等 </p>
</li>
<li><p>微任务队列（microtask queue）：Promise的then回调、 Mutation Observer API、queueMicrotask()等 </p>
</li>
</ul>
</li>
<li><p><strong>那么事件循环对于两个队列的优先级是怎么样的呢？</strong></p>
</li>
</ul>
<ol>
<li><p>main script中的代码优先执行（编写的顶层script代码）；</p>
</li>
<li><p>在执行任何一个宏任务之前（不是队列，是一个宏任务），都会先查看微任务队列中是否有任务需要执行也就是宏任务执行之前，必须保证微任务队列是空的；如果不为空，那么就优先执行微任务队列中的任务（回调）；</p>
</li>
</ol>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// setTimeout 的回调会被加入到另一个线程，然后等待一段时间再加入到队列中</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"setTimeout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// queueMicrotask 的回调会被直接加到队列中</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"queueMicrotask"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Promise then"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"bar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"其他代码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-none"><code class="language-none">bar
foo
其他代码
queueMicrotask
Promise then
setTimeout</code></pre>





<ul>
<li>下面我们通过几到面试题来练习一下：</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"setTimeout1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"then4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"then2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"promise1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"then1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"setTimeout2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"queueMicrotask1"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"then3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// promise1</span>
<span class="token comment">// 2</span>
<span class="token comment">// then1</span>
<span class="token comment">// queueMicrotask1</span>
<span class="token comment">// then3</span>
<span class="token comment">// setTimeout1</span>
<span class="token comment">// then2</span>
<span class="token comment">// then4</span>
<span class="token comment">// setTimeout2</span></code></pre>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// async function bar() &#123;</span>
<span class="token comment">//   console.log("22222")</span>
<span class="token comment">//   return new Promise((resolve) => &#123;</span>
<span class="token comment">//     resolve()</span>
<span class="token comment">//   &#125;)</span>
<span class="token comment">// &#125;</span>

<span class="token comment">// async function foo() &#123;</span>
<span class="token comment">//   console.log("111111")</span>

<span class="token comment">//   await bar()</span>

<span class="token comment">//   console.log("33333")</span>
<span class="token comment">// &#125;</span>

<span class="token comment">// foo()</span>
<span class="token comment">// console.log("444444")</span>


<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
 
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">new</span> <span class="token class-name">Promise</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span>

<span class="token comment">// script start</span>
<span class="token comment">// async1 start</span>
<span class="token comment">// async2</span>
<span class="token comment">// promise1</span>
<span class="token comment">// script end</span>
<span class="token comment">// async1 end</span>
<span class="token comment">// promise2</span>
<span class="token comment">// setTimeout</span></code></pre>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript">Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 1.直接return一个值 相当于resolve(4)</span>
    <span class="token comment">// return 4</span>

    <span class="token comment">// 2.return thenable的值</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      <span class="token function-variable function">then</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 此处可能会有大量的计算，所以将其推迟执行</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.return Promise</span>
    <span class="token comment">// 不是普通的值, 多加一次微任务</span>
    <span class="token comment">// Promise.resolve(4), 多加一次微任务</span>
    <span class="token comment">// 一共多加两次微任务</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1.return 4</span>
<span class="token comment">// 0</span>
<span class="token comment">// 1</span>
<span class="token comment">// 4</span>
<span class="token comment">// 2</span>
<span class="token comment">// 3</span>
<span class="token comment">// 5</span>
<span class="token comment">// 6</span>

<span class="token comment">// 2.return thenable</span>
<span class="token comment">// 0</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>
<span class="token comment">// 4</span>
<span class="token comment">// 3</span>
<span class="token comment">// 5</span>
<span class="token comment">// 6</span>

<span class="token comment">// 3.return promise</span>
<span class="token comment">// 0</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>
<span class="token comment">// 3</span>
<span class="token comment">// 4</span>
<span class="token comment">// 5</span>
<span class="token comment">// 6</span></code></pre>



<h2 id="Node-的事件循环"><a href="#Node-的事件循环" class="headerlink" title="Node 的事件循环"></a>Node 的事件循环</h2><ul>
<li><p>浏览器中的EventLoop是根据HTML5定义的规范来实现的，不同的浏览器可能会有不同的实现，而Node中是由libuv实现的。 </p>
</li>
<li><p>这里我们来给出一个Node的架构图： </p>
<ul>
<li><p>我们会发现libuv中主要维护了一个EventLoop和worker threads（线程池）；</p>
</li>
<li><p>EventLoop负责调用系统的一些其他操作：文件的IO、Network、child-processes等 </p>
</li>
</ul>
</li>
<li><p>libuv是一个多平台的专注于异步IO的库，它最初是为Node开发的，但是现在也被使用到Luvit、Julia、pyuv等其他地方；</p>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/4.jpg" loading="lazy"></p>
<h2 id="Node-事件循环的阶段"><a href="#Node-事件循环的阶段" class="headerlink" title="Node 事件循环的阶段"></a>Node 事件循环的阶段</h2><ul>
<li><p>我们最前面就强调过，<strong>事件循环像是一个桥梁</strong>，是连接着应用程序的JavaScript和系统调用之间的通道： （js -&gt; 浏览器 -&gt; 操作系统）</p>
<ul>
<li><p>无论是我们的文件IO、数据库、网络IO、定时器、子进程，在完成对应的操作后，都会将对应的结果和回调函数放到事件循环（任务队列）中；</p>
</li>
<li><p>事件循环会不断的从任务队列中取出对应的事件（回调函数）来执行；</p>
</li>
</ul>
</li>
<li><p><strong>但是一次完整的事件循环Tick分成很多个阶段（这些阶段都属于宏任务）：</strong></p>
<ul>
<li><p><strong>定时器（Timers）</strong>：本阶段执行已经被 setTimeout() 和 setInterval() 的调度回调函数。</p>
</li>
<li><p><strong>待定回调（Pending Callback）</strong>：对某些系统操作（如TCP错误类型）执行回调，比如TCP连接时接收到 ECONNREFUSED。 </p>
</li>
<li><p><strong>idle, prepare</strong>：仅系统内部使用。</p>
</li>
<li><p><strong>轮询（Poll）</strong>：检索新的 I/O 事件；执行与 I/O 相关的回调；</p>
</li>
<li><p><strong>检测（check）</strong>：setImmediate() 回调函数在这里执行。</p>
</li>
<li><p><strong>关闭的回调函数</strong>：一些关闭的回调函数，如：socket.on(‘close’, …)。</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/5.jpg" loading="lazy"></p>
<blockquote>
<p>每次Tick，都会将上面的各个队列依次循环执行一遍。</p>
<p>同时，Node 程序一般没有任务执行的情况下，会停留在 IO 阶段，查看是否有要执行的任务</p>
</blockquote>
<h2 id="Node-的宏任务与微任务"><a href="#Node-的宏任务与微任务" class="headerlink" title="Node 的宏任务与微任务"></a>Node 的宏任务与微任务</h2><ul>
<li><p>我们会发现从一次事件循环的Tick来说，Node的事件循环更复杂，它也分为微任务和宏任务：</p>
<ul>
<li><p>宏任务（macrotask）：setTimeout、setInterval、IO事件、setImmediate、close事件；</p>
</li>
<li><p>微任务（microtask）：Promise的then回调、process.nextTick、queueMicrotask； </p>
</li>
</ul>
</li>
<li><p>但是，Node中的事件循环不只是 微任务队列和 宏任务队列，在此基础上还分为了更多的情况：</p>
<ul>
<li><p>微任务队列：</p>
<ul>
<li><p>next tick queue：process.nextTick； </p>
</li>
<li><p>other queue：Promise的then回调、queueMicrotask； </p>
</li>
</ul>
</li>
<li><p>宏任务队列：</p>
<ul>
<li><p>timer queue：setTimeout、setInterval； </p>
</li>
<li><p>poll queue：IO事件；</p>
</li>
<li><p>check queue：setImmediate； </p>
</li>
<li><p>close queue：close事件；</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>所以，在每一次事件循环的tick中，会按照如下顺序来执行代码：</p>
<ul>
<li><p>next tick microtask queue； </p>
</li>
<li><p>other microtask queue； </p>
</li>
<li><p>timer queue； </p>
</li>
<li><p>poll queue； </p>
</li>
<li><p>check queue； </p>
</li>
<li><p>close queue；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout0'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout2'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>

<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span>

<span class="token comment">// script start</span>
<span class="token comment">// async1 start</span>
<span class="token comment">// async2</span>
<span class="token comment">// promise1</span>
<span class="token comment">// promise2</span>
<span class="token comment">// script end</span>
<span class="token comment">// nexttick1</span>
<span class="token comment">// nexttick2</span>
<span class="token comment">// async1 end</span>
<span class="token comment">// promise3</span>
<span class="token comment">// settimetout0</span>
<span class="token comment">// setImmediate</span>
<span class="token comment">// setTimeout2</span></code></pre>



<h1 id="错误处理方案"><a href="#错误处理方案" class="headerlink" title="错误处理方案"></a>错误处理方案</h1><ul>
<li><p>开发中我们会封装一些工具函数，封装之后给别人使用：</p>
<ul>
<li><p>在其他人使用的过程中，可能会传递一些参数；</p>
</li>
<li><p>对于函数来说，需要对这些参数进行验证，否则可能得到的是我们不想要的结果；</p>
</li>
</ul>
</li>
<li><p>很多时候我们可能验证到不是希望得到的参数时，就会直接return： </p>
<ul>
<li><p>但是return存在很大的弊端：调用者不知道是因为函数内部没有正常执行，还是执行结果就是一个undefined； </p>
</li>
<li><p>事实上，正确的做法应该是如果没有通过某些验证，那么应该让外界知道函数内部报错了；</p>
</li>
</ul>
</li>
<li><p><strong>如何可以让一个函数告知外界自己内部出现了错误呢？</strong></p>
<ul>
<li>通过throw关键字，抛出一个异常；</li>
</ul>
</li>
<li><p><strong>throw语句：</strong></p>
<ul>
<li><p>throw语句用于抛出一个用户自定义的异常；</p>
</li>
<li><p>当遇到throw语句时，当前的函数执行会被停止（throw后面的语句不会执行）；</p>
</li>
</ul>
</li>
<li><p>如果我们执行代码，就会报错，拿到错误信息的时候我们可以及时的去修正代码。</p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/**
 * 如果我们有一个函数, 在调用这个函数时, 如果出现了错误, 那么我们应该是去修复这个错误.
 */</span>

<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 当传入的参数的类型不正确时, 应该告知调用者一个错误</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> num1 <span class="token operator">!==</span> <span class="token string">"number"</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> num2 <span class="token operator">!==</span> <span class="token string">"number"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// return undefined</span>
    <span class="token keyword">throw</span> <span class="token string">"parameters is error type~"</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">&#125;</span>

<span class="token comment">// 调用者(如果没有对错误进行处理, 那么程序会直接终止)</span>
<span class="token comment">// console.log(sum(&#123; name: "why" &#125;, true))</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后续的代码会继续运行~"</span><span class="token punctuation">)</span></code></pre>

<h2 id="throw关键字"><a href="#throw关键字" class="headerlink" title="throw关键字"></a>throw关键字</h2><ul>
<li>throw表达式就是在throw后面可以跟上一个表达式来表示具体的异常信息：</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/6.jpg" loading="lazy"></p>
<ul>
<li><p>throw关键字可以跟上哪些类型呢？</p>
<ul>
<li><p>基本数据类型：比如number、string、Boolean</p>
</li>
<li><p>对象类型：对象类型可以包含更多的信息</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数开始执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 1.抛出一个字符串类型(基本的数据类型)</span>
    <span class="token keyword">throw</span> <span class="token string">"error"</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数后续的代码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数结束执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后续的代码继续执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>结果：</p>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/7.jpg" loading="lazy"></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数开始执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token punctuation">&#123;</span> errorCode<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1001</span><span class="token punctuation">,</span> errorMessage<span class="token operator">:</span> <span class="token string">"type不能为0~"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数后续的代码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数结束执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后续的代码继续执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>结果：</p>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/8.jpg" loading="lazy"></p>
<ul>
<li>但是每次写这么长的对象又有点麻烦，所以我们可以创建一个类：</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">HYError</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">errorCode<span class="token punctuation">,</span> errorMessage</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>errorCode <span class="token operator">=</span> errorCode<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>errorMessage <span class="token operator">=</span> errorMessage<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数开始执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HYError</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token string">"type不能为0~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数后续的代码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数结束执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后续的代码继续执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>结果：</p>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/9.jpg" loading="lazy"></p>
<h2 id="Error-类型"><a href="#Error-类型" class="headerlink" title="Error 类型"></a>Error 类型</h2><ul>
<li><p>事实上，JavaScript已经给我们提供了一个Error类，我们可以直接创建这个类的对象：</p>
</li>
<li><p>Error包含三个属性：</p>
<ul>
<li><p>messsage：创建Error对象时传入的message； </p>
</li>
<li><p>name：Error的名称，通常和类的名称一致；</p>
</li>
<li><p>stack：整个Error的错误信息，包括函数的调用栈，当我们直接打印Error对象时，打印的就是stack； </p>
</li>
</ul>
</li>
<li><p>Error有一些自己的子类：</p>
<ul>
<li><p>RangeError：下标值越界时使用的错误类型；</p>
</li>
<li><p>SyntaxError：解析语法错误时使用的错误类型；</p>
</li>
<li><p>TypeError：出现类型错误时，使用的错误类型；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数开始执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 4.提供了一个Error</span>
    <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"type不能为0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    err<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"why"</span><span class="token punctuation">;</span>
    err<span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token string">"aaaa"</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数后续的代码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数结束执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后续的代码继续执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>结果：</p>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/10.jpg" loading="lazy"></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数开始执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">"当前type类型是错误的~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数后续的代码"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo函数结束执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后续的代码继续执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>结果：</p>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/11.jpg" loading="lazy"></p>
<h2 id="异常的处理"><a href="#异常的处理" class="headerlink" title="异常的处理"></a>异常的处理</h2><ul>
<li><p>我们会发现在之前的代码中，<strong>一个函数抛出了异常，调用它的时候程序会被强制终止：</strong></p>
<ul>
<li><p>这是因为如果我们在调用一个函数时，这个函数抛出了异常，但是我们并没有对这个异常进行处理，那么这个异常会继续传递到上一个函数调用中；</p>
</li>
<li><p>而如果到了最顶层（全局）的代码中依然没有对这个异常的处理代码，这个时候就会报错并且终止程序的运行；</p>
</li>
</ul>
</li>
<li><p><strong>我们先来看一下这段代码的异常传递过程：</strong></p>
<ul>
<li><p>foo函数在被执行时会抛出异常，也就是我们的bar函数会拿到这个异常；</p>
</li>
<li><p>但是bar函数并没有对这个异常进行处理，那么这个异常就会被继续传递到调用bar函数的函数，也就是test函数；</p>
</li>
<li><p>但是test函数依然没有处理，就会继续传递到我们的全局代码逻辑中；</p>
</li>
<li><p>依然没有被处理，这个时候程序会终止执行，后续代码都不会再执行了；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/12.jpg" loading="lazy"></p>
<h2 id="异常的捕获"><a href="#异常的捕获" class="headerlink" title="异常的捕获"></a>异常的捕获</h2><ul>
<li>但是很多情况下当出现异常时，我们并不希望程序直接推出，而是希望可以正确的处理异常：<ul>
<li>这个时候我们就可以使用try catch</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"foo error message~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"error:"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"后续的代码执行~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<ul>
<li><p>多层函数嵌套调用时，若发生错误，会向上查找是否有捕获，被第一次捕获到后执行其的 catch 函数后，继续执行。</p>
</li>
<li><p>在ES10（ES2019）中，catch后面绑定的error可以省略。</p>
</li>
<li><p>当然，如果有一些必须要执行的代码，我们可以使用finally来执行：</p>
<ul>
<li><p>finally表示最终一定会被执行的代码结构；</p>
</li>
<li><p>注意：如果try和finally中都有返回值，那么会使用finally当中的返回值；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"bar函数后续的继续运行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"err:"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// alert(err.message)    // 弹出错误提示框</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"finally代码执行~, close操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 此处会进行一些 close 操作</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h1 id="JavaScript-模块化"><a href="#JavaScript-模块化" class="headerlink" title="JavaScript 模块化"></a>JavaScript 模块化</h1><h2 id="什么是模块化？"><a href="#什么是模块化？" class="headerlink" title="什么是模块化？"></a>什么是模块化？</h2><ul>
<li><p>无论你多么喜欢JavaScript，以及它现在发展的有多好，它都有很多的缺陷：</p>
<ul>
<li><p>比如var定义的变量作用域问题；</p>
</li>
<li><p>比如JavaScript的面向对象并不能像常规面向对象语言一样使用class； </p>
</li>
<li><p>比如JavaScript没有模块化的问题；</p>
</li>
<li><p><em>Brendan Eich</em>本人也多次承认过JavaScript设计之初的缺陷，但是随着JavaScript的发展以及标准化，存在的缺陷问题基本都得到了完善。 </p>
</li>
</ul>
</li>
<li><p><strong>到底什么是模块化、模块化开发呢？</strong></p>
<ul>
<li><p>事实上模块化开发最终的目的是将程序划分成一个个小的结构； </p>
</li>
<li><p>这个结构中编写属于自己的逻辑代码，有自己的作用域，不会影响到其他的结构；</p>
</li>
<li><p>这个结构可以将自己希望暴露的变量、函数、对象等导出给其结构使用；</p>
</li>
<li><p>也可以通过某种方式，导入另外结构中的变量、函数、对象等；</p>
</li>
</ul>
</li>
<li><p>上面说提到的 <strong>结构</strong>，就是<strong>模块</strong>；按照这种结构划分开发程序的过程，就是模块化开发的过程；</p>
</li>
</ul>
<h2 id="模块化的历史"><a href="#模块化的历史" class="headerlink" title="模块化的历史"></a>模块化的历史</h2><ul>
<li><p>在网页开发的早期，<em>Brendan Eich</em>开发JavaScript仅仅作为一种脚本语言，做一些简单的表单验证或动画实现等，那个时候代码还是很少的：</p>
<ul>
<li><p>这个时候我们只需要将JavaScript代码写到 <code>&lt;script&gt;</code>标签中即可；</p>
</li>
<li><p>并没有必要放到多个文件中来编写；甚至流行：通常来说 JavaScript 程序的长度只有一行。 </p>
</li>
</ul>
</li>
<li><p>但是随着前端和JavaScript的快速发展，JavaScript代码变得越来越复杂了：</p>
<ul>
<li><p>ajax的出现，前后端开发分离，意味着后端返回数据后，我们需要通过JavaScript进行前端页面的渲染； </p>
</li>
<li><p>SPA的出现，前端页面变得更加复杂：包括前端路由、状态管理等等一系列复杂的需求需要通过JavaScript来实现；</p>
</li>
<li><p>包括Node的实现，JavaScript编写复杂的后端程序，没有模块化是致命的硬伤； </p>
</li>
</ul>
</li>
<li><p>所以，模块化已经是JavaScript一个非常迫切的需求： </p>
<ul>
<li><p>但是JavaScript本身，直到ES6（2015）才推出了自己的模块化方案； </p>
</li>
<li><p>在此之前，为了让JavaScript支持模块化，涌现出了很多不同的模块化规范：AMD、CMD、CommonJS等；</p>
</li>
</ul>
</li>
</ul>
<h2 id="没有模块化带来的问题"><a href="#没有模块化带来的问题" class="headerlink" title="没有模块化带来的问题"></a>没有模块化带来的问题</h2><ul>
<li><p>早期没有模块化带来了很多的问题：比如命名冲突的问题</p>
</li>
<li><p><strong>当然，我们有办法可以解决上面的问题：立即函数调用表达式（IIFE）</strong> </p>
<ul>
<li><strong>IIFE</strong> (Immediately Invoked Function Expression) </li>
</ul>
</li>
</ul>
<p><strong>kobe/index.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> moduleB <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"why"</span>
  <span class="token keyword">var</span> isFlag <span class="token operator">=</span> <span class="token boolean">false</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> name<span class="token punctuation">,</span>
    isFlag<span class="token operator">:</span> isFlag
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><strong>why/index.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> moduleA <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">"why"</span>
  <span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">18</span>
  <span class="token keyword">var</span> isFlag <span class="token operator">=</span> <span class="token boolean">true</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> name<span class="token punctuation">,</span>
    isFlag<span class="token operator">:</span> isFlag
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><strong>why/why.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span>isFlag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我的名字是"</span> <span class="token operator">+</span> moduleA<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><strong>index.html</strong></p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./why/index.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./kobe/index.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./why/why.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<ul>
<li><p>但是，我们其实带来了新的问题：</p>
<ul>
<li><p>第一，我必须记得每一个模块中返回对象的命名，才能在其他模块使用过程中正确的使用；</p>
</li>
<li><p>第二，代码写起来混乱不堪，每个文件中的代码都需要包裹在一个匿名函数中来编写； </p>
</li>
<li><p>第三，在没有合适的规范情况下，每个人、每个公司都可能会任意命名、甚至出现模块名称相同的情况； </p>
</li>
</ul>
</li>
<li><p><strong>所以，我们会发现，虽然实现了模块化，但是我们的实现过于简单，并且是没有规范的。</strong></p>
<ul>
<li><p>我们需要制定一定的规范来约束每个人都按照这个规范去编写模块化的代码； </p>
</li>
<li><p>这个规范中应该包括核心功能：模块本身可以导出暴露的属性，模块又可以导入自己需要的属性；</p>
</li>
</ul>
</li>
</ul>
<h2 id="Commonjs-规范和-nodejs-的关系"><a href="#Commonjs-规范和-nodejs-的关系" class="headerlink" title="Commonjs 规范和 nodejs 的关系"></a>Commonjs 规范和 nodejs 的关系</h2><ul>
<li><p>我们需要知道CommonJS是一个规范，最初提出来是在浏览器以外的地方使用，并且当时被命名为<strong>ServerJS</strong>，后来为了体现它的广泛性，修改为<strong>CommonJS</strong>，平时我们也会简称为CJS。 </p>
<ul>
<li><p>Node是CommonJS在服务器端一个具有代表性的实现；</p>
</li>
<li><p>Browserify是CommonJS在浏览器中的一种实现；</p>
</li>
<li><p>webpack打包工具具备对CommonJS的支持和转换； </p>
</li>
</ul>
</li>
<li><p>所以，Node中对CommonJS进行了支持和实现，让我们在开发node的过程中可以方便的进行模块化开发：</p>
<ul>
<li><p>在Node中每一个js文件都是一个单独的模块； </p>
</li>
<li><p>这个模块中包括CommonJS规范的核心变量：exports、module.exports、require； </p>
</li>
<li><p>我们可以使用这些变量来方便的进行模块化开发； </p>
</li>
</ul>
</li>
<li><p>前面我们提到过模块化的核心是导出和导入，Node中对其进行了实现：</p>
<ul>
<li><p>exports和module.exports可以负责对模块中的内容进行导出； </p>
</li>
<li><p>require函数可以帮助我们导入其他模块（自定义模块、系统模块、第三方库模块）中的内容；</p>
</li>
</ul>
</li>
</ul>
<p><strong>main.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用另外一个模块导出的对象, 那么就要进行导入 require</span>
<span class="token comment">// const &#123; aaa, bbb &#125; = require("./why.js")</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sum <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./why.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// require 方法会返回对应文件导出的对象</span>

<span class="token comment">// console.log(aaa)</span>
<span class="token comment">// console.log(bbb)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p><strong>why.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"why"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 1.导出方案 module.exports</span>
<span class="token comment">// module 是 why.js 本身这个对象，对象中有个 exports 对象，凡是写在这个对象中的属性都会被导出</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// aaa: "hahahahaah",</span>
  <span class="token comment">// bbb: "bbb"</span>
  name<span class="token punctuation">,</span>
  age<span class="token punctuation">,</span>
  sum<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<ul>
<li>实现原理其实是：通过 module.exports 导出一个对象后，再另一个模块使用 require 方法传入一个搜索值，找到这个值对应的模块，并将 这个模块的 module.exports 对应的值返回。使得 require 返回的对象 与 module.exports 指向的 对象为同一个对象。 若此后在 require 中获取到对象中的属性并修改，源文件中的 对应属性也会被修改（不推荐这样做）。</li>
</ul>
<h2 id="exports-导出"><a href="#exports-导出" class="headerlink" title="exports 导出"></a>exports 导出</h2><ul>
<li><strong>注意：exports是一个对象，我们可以在这个对象中添加很多个属性，添加的属性会导出；</strong></li>
</ul>
<p><strong>main.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">exports<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>sayHello <span class="token operator">=</span> sayHello<span class="token punctuation">;</span></code></pre>

<ul>
<li><strong>另外一个文件中可以导入：</strong></li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<ul>
<li><p>上面这行完成了什么操作呢？理解下面这句话，Node中的模块化一目了然</p>
<ul>
<li><p><strong>意味着main中的bar变量等于exports对象；</strong></p>
</li>
<li><p>也就是require通过各种查找方式，最终找到了exports这个对象；</p>
</li>
<li><p>并且将这个exports对象赋值给了bar变量；</p>
</li>
<li><p>bar变量就是exports对象了；</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>但是Node中我们经常导出东西的时候，又是通过module.exports导出的：</p>
<ul>
<li>module.exports和exports有什么关系或者区别呢？</li>
</ul>
</li>
<li><p>我们追根溯源，通过维基百科中对CommonJS规范的解析：</p>
<ul>
<li><p>CommonJS中是没有module.exports的概念的；</p>
</li>
<li><p>但是为了实现模块的导出，Node中使用的是Module的类，每一个模块都是Module的一个实例，也就是module； </p>
</li>
<li><p>所以在Node中真正用于导出的其实根本不是exports，而是module.exports； </p>
</li>
<li><p>因为module才是导出的真正实现者； </p>
</li>
</ul>
</li>
<li><p>但是，为什么exports也可以导出呢？</p>
<ul>
<li><p>这是因为module对象的exports属性是exports对象的一个引用；</p>
</li>
<li><p>也就是说 module.exports = exports = main中的bar；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 这种代码不会进行导出，因此最终能导出的一定是 module.exports。</span>
<span class="token comment">// exports能导出对象 只是由于 node 将其与 module.exports 指向了同一个地址</span>
<span class="token comment">// 而此处修改了 exports 的指向，就导致其不再具备导出属性的效果了</span>
exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  name<span class="token punctuation">,</span>
  age<span class="token punctuation">,</span>
  sum<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 这种代码exports 里的属性不会进行导出</span>
exports<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>sum <span class="token operator">=</span> sum<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 最终能导出的一定是module.exports</span></code></pre>



<h2 id="require-细节"><a href="#require-细节" class="headerlink" title="require 细节"></a>require 细节</h2><ul>
<li>我们现在已经知道，<strong>require是一个函数</strong>，可以帮助我们引入一个文件（模块）中导出的对象。那么，require的查找规则是怎么样的呢？</li>
</ul>
<ul>
<li><p><strong>这里我总结比较常见的查找规则：</strong>导入格式如下：require(X)</p>
</li>
<li><p>情况一：X是一个Node核心模块，比如path、http</p>
<ul>
<li>直接返回核心模块，并且停止查找</li>
</ul>
</li>
<li><p><strong>情况二：X是以 ./ 或 ../ 或 /（根目录）开头的</strong></p>
</li>
<li><p>第一步：将X当做一个文件在对应的目录下查找；</p>
<ul>
<li><p>1.如果有后缀名，按照后缀名的格式查找对应的文件</p>
</li>
<li><p>2.如果没有后缀名，会按照如下顺序：</p>
<ul>
<li><p>1&gt; 直接查找文件X </p>
</li>
<li><p>2&gt; 查找X.js文件</p>
</li>
<li><p>3&gt; 查找X.json文件</p>
</li>
<li><p>4&gt; 查找X.node文件</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>第二步：没有找到对应的文件，将X作为一个目录</p>
<ul>
<li><p>查找目录下面的index文件</p>
<ul>
<li><p>1&gt; 查找X/index.js文件</p>
</li>
<li><p>2&gt; 查找X/index.json文件</p>
</li>
<li><p>3&gt; 查找X/index.node文件</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>如果没有找到，那么报错：not found</p>
</li>
</ul>
<ul>
<li><p>情况三：直接是一个X（没有路径），并且X不是一个核心模块</p>
<ul>
<li><p>/Users/coderwhy/Desktop/Node/TestCode/04_learn_node/05_javascript-module/02_commonjs/main.js中编写 require(‘why’)。则其会去如下的路径中逐一查找，找到对应文件夹后，会去引入其中的 index.js 文件</p>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/13.jpg" loading="lazy"></p>
</li>
<li><p>如果上面的路径中都没有找到，那么报错：not found。</p>
</li>
</ul>
</li>
</ul>
<h2 id="模块的加载过程"><a href="#模块的加载过程" class="headerlink" title="模块的加载过程"></a>模块的加载过程</h2><ul>
<li><p><strong>结论一：模块在被第一次引入时，模块中的js代码会被运行一次</strong></p>
</li>
<li><p><strong>结论二：模块被多次引入时，会缓存，最终只加载（运行）一次</strong></p>
<ul>
<li><p>为什么只会加载运行一次呢？</p>
</li>
<li><p>这是因为每个模块对象module都有一个属性：loaded。 （js文件 -&gt; Module的实例 -&gt; loaded）</p>
</li>
<li><p>为false表示还没有加载，为true表示已经加载；已加载的话，便不会再运行。</p>
</li>
</ul>
</li>
</ul>
<p><strong>foo.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"why"</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo:"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo中的代码被运行"</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  name<span class="token punctuation">,</span>
  age
<span class="token punctuation">&#125;</span></code></pre>

<p><strong>main.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"main.js代码开始运行"</span><span class="token punctuation">)</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./foo"</span><span class="token punctuation">)</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./foo"</span><span class="token punctuation">)</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./foo"</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"main.js代码后续运行"</span><span class="token punctuation">)</span></code></pre>

<ul>
<li><strong>结论三：如果有循环引入，那么加载顺序是什么？</strong></li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/14.jpg" loading="lazy"></p>
<ul>
<li><p>如果出现上图模块的引用关系，那么加载顺序是什么呢？</p>
<ul>
<li><p>这个其实是一种数据结构：图结构；</p>
</li>
<li><p>图结构在遍历的过程中，有深度优先搜索（DFS, depth first search）和广度优先搜索（BFS, breadth first search）；</p>
</li>
<li><p>Node采用的是深度优先算法：main -&gt; aaa -&gt; ccc -&gt; ddd -&gt; eee -&gt;bbb</p>
</li>
</ul>
</li>
</ul>
<p><strong>main.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./aaa"</span><span class="token punctuation">)</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./bbb"</span><span class="token punctuation">)</span></code></pre>

<p><strong>aaa.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">)</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./ccc"</span><span class="token punctuation">)</span></code></pre>

<p><strong>bbb.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"bbb"</span><span class="token punctuation">)</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./ccc"</span><span class="token punctuation">)</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./eee"</span><span class="token punctuation">)</span></code></pre>

<p><strong>ccc.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ccc"</span><span class="token punctuation">)</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./ddd"</span><span class="token punctuation">)</span></code></pre>

<p><strong>ddd.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"ddd"</span><span class="token punctuation">)</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./eee"</span><span class="token punctuation">)</span></code></pre>

<p><strong>eee.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"eee"</span><span class="token punctuation">)</span></code></pre>

<pre class="language-none"><code class="language-none">main
aaa
ccc
ddd
eee
bbb</code></pre>



<h2 id="Commonjs-模块化规范的缺点"><a href="#Commonjs-模块化规范的缺点" class="headerlink" title="Commonjs 模块化规范的缺点"></a>Commonjs 模块化规范的缺点</h2><ul>
<li><p><strong>CommonJS加载模块是同步的：</strong></p>
<ul>
<li><p>同步的意味着只有等到对应的模块加载完毕，当前模块中的内容才能被运行； </p>
</li>
<li><p>这个在服务器不会有什么问题，因为服务器加载的js文件都是本地文件，加载速度非常快； </p>
</li>
</ul>
</li>
<li><p><strong>如果将它应用于浏览器呢？</strong></p>
<ul>
<li>浏览器加载js文件需要先从服务器将文件下载下来，之后再加载运行； </li>
<li>那么采用同步的就意味着后续的js代码都无法正常运行，即使是一些简单的DOM操作； </li>
<li>为了让浏览器中能够使用 commonjs 规范，可以使用一些库：如 browserify.js。其仍然遵守 commonjs 规范，但使用异步加载的方式。</li>
</ul>
</li>
<li><p><strong>所以在浏览器中，我们通常不使用CommonJS规范：</strong></p>
<ul>
<li><p>当然在webpack中使用CommonJS是另外一回事；</p>
</li>
<li><p>因为它会将我们的代码转成浏览器可以直接执行的代码；</p>
</li>
</ul>
</li>
<li><p>在早期为了可以<strong>在浏览器中使用模块化，通常会采用AMD或CMD</strong>： </p>
<ul>
<li><p>但是目前一方面现代的浏览器已经支持ES Modules，另一方面借助于webpack等工具可以实现对CommonJS或者ES Module代码的转换； </p>
</li>
<li><p>AMD和CMD已经使用非常少了，所以这里我们进行简单的演练；</p>
</li>
</ul>
</li>
</ul>
<h2 id="AMD-规范"><a href="#AMD-规范" class="headerlink" title="AMD 规范"></a>AMD 规范</h2><ul>
<li><p><strong>AMD主要是应用于浏览器的一种模块化规范：</strong></p>
<ul>
<li><p>AMD是Asynchronous Module Definition（异步模块定义）的缩写；</p>
</li>
<li><p>它采用的是<code>异步加载模块</code>； </p>
</li>
<li><p>事实上AMD的规范还要早于CommonJS，但是CommonJS目前依然在被使用，而AMD使用的较少了；</p>
</li>
</ul>
</li>
<li><p>我们提到过，<strong>规范只是定义代码的应该如何去编写</strong>，只有有了具体的实现才能被应用：</p>
<ul>
<li>AMD实现的比较常用的库是require.js和curl.js；</li>
</ul>
</li>
<li><p>下面展示一下 require.js 的使用：</p>
</li>
<li><p>第一步：下载require.js</p>
<ul>
<li><p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/requirejs/requirejs">https://github.com/requirejs/requirejs</a></p>
</li>
<li><p>找到其中的require.js文件；</p>
</li>
</ul>
</li>
<li><p>第二步：定义HTML的script标签引入require.js和定义入口文件：</p>
<ul>
<li>data-main属性的作用是在加载完src的文件后会加载执行该文件</li>
</ul>
</li>
</ul>
<p><strong>index.html</strong></p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./lib/require.js<span class="token punctuation">"</span></span> <span class="token attr-name">data-main</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./src/main.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<p><strong>src/bar.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"-----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"bar:"</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 也可以在定义模块的时候直接引用</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"--------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"bar:"</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p><strong>src/foo.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"why"</span>
  <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span>
  <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    name<span class="token punctuation">,</span>
    age<span class="token punctuation">,</span>
    sum
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<p><strong>src/main.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 此处的 require 是 require.js 中定义好的</span>
require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  baseUrl<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">// baseUrl 的默认值是 ./src</span>
  paths<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    foo<span class="token operator">:</span> <span class="token string">"./src/foo"</span><span class="token punctuation">,</span> <span class="token comment">// 此处的路径是相对于 index.html 的</span>
    bar<span class="token operator">:</span> <span class="token string">"./src/bar"</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"bar"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"main:"</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<h2 id="CMD-规范"><a href="#CMD-规范" class="headerlink" title="CMD 规范"></a>CMD 规范</h2><ul>
<li><p>CMD规范也是应用于浏览器的一种模块化规范： </p>
<ul>
<li><p>CMD 是Common Module Definition（通用模块定义）的缩写；</p>
</li>
<li><p>它也采用了异步加载模块，但是它将CommonJS的优点吸收了过来（一些关键字）；</p>
</li>
<li><p>但是目前CMD使用也非常少了；</p>
</li>
</ul>
</li>
<li><p>CMD也有自己比较优秀的实现方案： </p>
<ul>
<li>SeaJS</li>
</ul>
</li>
<li><p>第一步：下载SeaJS</p>
<ul>
<li><p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/seajs/seajs">https://github.com/seajs/seajs</a></p>
</li>
<li><p>找到dist文件夹下的sea.js</p>
</li>
</ul>
</li>
<li><p>第二步：引入sea.js和使用主入口文件</p>
<ul>
<li>seajs是指定主入口文件的</li>
</ul>
</li>
</ul>
<p><strong>index.html</strong></p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./lib/sea.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    seajs<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"./src/main.js"</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<p><strong>src/main.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./foo"</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"main:"</span><span class="token punctuation">,</span> foo<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<p><strong>src/foo.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"why"</span>
  <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span>
  <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// exports.name = name</span>
  <span class="token comment">// exports.age = age</span>

  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    name<span class="token punctuation">,</span>
    age<span class="token punctuation">,</span>
    sum
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<h2 id="认识-ESModule"><a href="#认识-ESModule" class="headerlink" title="认识 ESModule"></a>认识 ESModule</h2><ul>
<li><p>JavaScript没有模块化一直是它的痛点，所以才会产生我们前面学习的社区规范：CommonJS、AMD、CMD等，所以在ES推出自己的模块化系统时，大家也是兴奋异常。</p>
</li>
<li><p>ES Module和CommonJS的模块化有一些不同之处：</p>
<ul>
<li><p>一方面它使用了import和export关键字；</p>
</li>
<li><p>另一方面它采用编译期的静态分析，并且也加入了动态引用的方式；</p>
</li>
</ul>
</li>
<li><p>ES Module模块采用export和import关键字来实现模块化：</p>
<ul>
<li><p>export负责将模块内的内容导出；</p>
</li>
<li><p>import负责从其他模块导入内容； </p>
</li>
</ul>
</li>
<li><p>了解：采用ES Module将自动采用严格模式：<strong>use strict</strong></p>
</li>
</ul>
<ul>
<li>在浏览器中演示 ES6 的模块化开发</li>
</ul>
<p><strong>index.html</strong></p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- 默认情况下 script 加载文件会将其作为普通的js文件（加载完直接从上往下运行，里面若有 import 会报错） --></span>
  <span class="token comment">&lt;!-- 通过 type="module" 可以声明加载的文件是一个模块 --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./main.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<p><strong>main.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./foo.js"</span><span class="token punctuation">;</span> <span class="token comment">// 注意：此处并非 webpack 环境，所以必须加 .js 后缀</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p><strong>foo.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"why"</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span></code></pre>

<ul>
<li>如果直接在浏览器中通过 file 协议运行代码，会报如下错误：</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/15.jpg" loading="lazy"></p>
<ul>
<li><p>这个在MDN上面有给出解释： </p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules</a></p>
</li>
<li><p>你需要注意本地测试 — 如果你通过本地加载Html 文件 (比如一个 file:// 路径的文件), 你将会遇到 CORS 错误，因为Javascript 模块安全性需要。</p>
</li>
<li><p>你需要通过一个服务器来测试。 </p>
</li>
</ul>
</li>
<li><p>这里推荐使用的VSCode，VSCode中有一个插件：Live Server</p>
</li>
</ul>
<h2 id="exports-关键字"><a href="#exports-关键字" class="headerlink" title="exports 关键字"></a>exports 关键字</h2><ul>
<li><p>export关键字将一个模块中的变量、函数、类等导出；</p>
</li>
<li><p><strong>我们希望将其他内容全部导出，它可以有如下的方式：</strong></p>
</li>
<li><p>方式一：在语句声明的前面直接加上export关键字</p>
</li>
<li><p>方式二：将所有需要导出的标识符，放到export后面的 {}中 </p>
<ul>
<li><p>注意：这里的 {}里面不是ES6的对象字面量的增强写法，{}也不是表示一个对象；</p>
</li>
<li><p>所以： export {name: name}，是错误的写法；</p>
</li>
</ul>
</li>
<li><p>方式三：导出时给标识符起一个别名</p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1.第一种方式: export 声明语句</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"why"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token comment">// 2.第二种方式: export 导出 和 声明分开</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"why"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 注意：此处的 &#123;&#125; 不是对象，而是一种固定的语法。内部放入标识符</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> foo <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 3.第三种方式: 第二种导出时起别名</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> name <span class="token keyword">as</span> fName<span class="token punctuation">,</span> age <span class="token keyword">as</span> fAge<span class="token punctuation">,</span> foo <span class="token keyword">as</span> fFoo <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>



<h2 id="import-关键字"><a href="#import-关键字" class="headerlink" title="import 关键字"></a>import 关键字</h2><ul>
<li><p>import关键字负责从另外一个模块中导入内容</p>
</li>
<li><p><strong>导入内容的方式也有多种：</strong></p>
</li>
<li><p>方式一：import {标识符列表} from ‘模块’； </p>
<ul>
<li>注意：这里的{}也不是一个对象，里面只是存放导入的标识符列表内容； </li>
</ul>
</li>
<li><p>方式二：导入时给标识符起别名 </p>
</li>
<li><p>方式三：通过 * 将模块功能放到一个模块功能对象（a module object）上</p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1.导入方式一: 普通的导入</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> foo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./foo.js"</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> fName<span class="token punctuation">,</span> fAge<span class="token punctuation">,</span> fFoo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./foo.js'</span>

<span class="token comment">// 2.导入方式二: 起别名</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> name <span class="token keyword">as</span> fName<span class="token punctuation">,</span> age <span class="token keyword">as</span> fAge<span class="token punctuation">,</span> foo <span class="token keyword">as</span> fFoo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./foo.js'</span>

<span class="token comment">// 3.导入方式三: 将导出的所有内容放到一个标识符中</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> foo <span class="token keyword">from</span> <span class="token string">'./foo.js'</span></code></pre>



<h2 id="export-和-import-结合使用"><a href="#export-和-import-结合使用" class="headerlink" title="export 和 import 结合使用"></a>export 和 import 结合使用</h2><ul>
<li><p><strong>export和import可以结合使用</strong></p>
</li>
<li><p>为什么要这样做呢？</p>
<ul>
<li><p>在开发和封装一个功能库时，通常我们希望将暴露的所有接口放到一个文件中；</p>
</li>
<li><p>这样方便指定统一的接口规范，也方便阅读； </p>
</li>
<li><p>这个时候，我们就可以使用export和import结合使用；</p>
</li>
</ul>
</li>
</ul>
<p><strong>utils/index.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1.导出方式一:</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> add<span class="token punctuation">,</span> sub <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./math.js'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> timeFormat<span class="token punctuation">,</span> priceFormat <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./format.js'</span>

<span class="token keyword">export</span> <span class="token punctuation">&#123;</span>
  add<span class="token punctuation">,</span>
  sub<span class="token punctuation">,</span>
  timeFormat<span class="token punctuation">,</span>
  priceFormat
<span class="token punctuation">&#125;</span>

<span class="token comment">// 2.导出方式二:</span>
<span class="token comment">// 此种方式可读性更强</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> add<span class="token punctuation">,</span> sub <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./math.js'</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> timeFormat<span class="token punctuation">,</span> priceFormat <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./format.js'</span>

<span class="token comment">// 3.导出方式三:</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">"./math.js"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">"./format.js"</span><span class="token punctuation">;</span></code></pre>

<p><strong>main.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> add<span class="token punctuation">,</span> sub<span class="token punctuation">,</span> priceFormat<span class="token punctuation">,</span> timeFormat <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./utils/index.js'</span></code></pre>



<h2 id="default-用法"><a href="#default-用法" class="headerlink" title="default 用法"></a>default 用法</h2><ul>
<li><p>前面我们学习的导出功能都是有名字的导出（named exports）：</p>
<ul>
<li><p>在导出export时指定了名字；</p>
</li>
<li><p>在导入import时需要知道具体的名字；</p>
</li>
</ul>
</li>
<li><p>还有一种导出叫做默认导出（default export） </p>
<ul>
<li><p>默认导出export时可以不需要指定名字；</p>
</li>
<li><p>在导入时不需要使用 {}，并且可以自己来指定名字；</p>
</li>
<li><p>它也方便我们和现有的CommonJS等规范相互操作；</p>
</li>
</ul>
</li>
<li><p>注意：在一个模块中，只能有一个默认导出（default export）；</p>
</li>
</ul>
<p><strong>foo.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"why"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token string">"foo value"</span><span class="token punctuation">;</span>

<span class="token comment">// 1.默认导出的方式一:</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// named export 模式</span>
  name<span class="token punctuation">,</span>
  <span class="token comment">// default export 模式</span>
  age <span class="token keyword">as</span> <span class="token keyword">default</span><span class="token punctuation">,</span>
  <span class="token comment">// foo as default // 报错，注意: 默认导出只能有一个</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 2.默认导出的方式二: 常见</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> foo<span class="token punctuation">;</span></code></pre>

<p><strong>main.js</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 导入语句: 导入的默认的导出</span>
<span class="token keyword">import</span> why <span class="token keyword">from</span> <span class="token string">'./foo.js'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>why<span class="token punctuation">)</span></code></pre>

<h2 id="import-函数"><a href="#import-函数" class="headerlink" title="import 函数"></a>import 函数</h2><ul>
<li>通过import加载一个模块，是不可以在其放到逻辑代码中的。</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/16.jpg" loading="lazy"></p>
<ul>
<li><p>为什么会出现这个情况呢？</p>
<ul>
<li>这是因为ES Module在被JS引擎解析时，就必须知道它的依赖关系；</li>
</ul>
</li>
<li><p>但是某些情况下，我们确确实实希望动态的来加载某一个模块：</p>
<ul>
<li><p>如果根据不懂的条件，动态来选择加载模块的路径；</p>
</li>
<li><p>这个时候我们需要使用 import() 函数来动态加载；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// import &#123; name, age, foo &#125; from './foo.js'    // 这种写法也是相当于一种同步的写法，必须等 foo.js 下载、解析、实例化、求值完后，才能执行下面的代码。</span>

<span class="token comment">// console.log(name)</span>

<span class="token comment">// import函数返回的结果是一个Promise。这种写法不会阻塞下面代码的运行</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"./foo.js"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"res:"</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<ul>
<li><p>import.meta是一个给JavaScript模块暴露特定上下文的元数据属性的对象。 </p>
<ul>
<li><p>它包含了这个模块的信息，比如说这个模块的URL； </p>
</li>
<li><p>在ES11（ES2020）中新增的特性；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ES11新增的特性</span>
<span class="token comment">// meta属性本身也是一个对象: &#123; url: "当前模块所在的路径" &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &#123;url: 'http://127.0.0.1:5501/30_JS%E6%A8%A1%E5%9D%97%E5%8…0/05_ESModule/05_import%E5%87%BD%E6%95%B0/main.js'&#125;</span></code></pre>



<h2 id="ES-Module-的解析流程"><a href="#ES-Module-的解析流程" class="headerlink" title="ES Module 的解析流程"></a>ES Module 的解析流程</h2><ul>
<li>前面说过，commonjs 属于对象的一种赋值，通过 require 函数将导出的对象赋值到另一个模块的某一个标识符上面。通过这个标识符，我们可以拿到同一个对象，任何一个标识符对当前对象做了修改，另一个地方也会发生改变。</li>
</ul>
<ul>
<li><p>那么ES Module是如何被浏览器解析并且让模块之间可以相互引用的呢？</p>
</li>
<li><p>ES Module的解析过程可以划分为三个阶段：</p>
<ul>
<li><p>阶段一：构建（Construction），根据地址查找js文件，并且下载，将其解析成模块记录（Module Record -&gt; 一种数据结构）；(这也是为什么 file 协议会报错，因为其对应一个本地路径，而 esModule 是要对其进行下载的)</p>
</li>
<li><p>阶段二：实例化（Instantiation），对模块记录进行实例化，并且分配内存空间，解析模块的导入和导出语句，把模块指向对应的内存地址。 （此时内存空间中保存的值为 undefined，因为此时只会执行 export 和 import ，而内部的赋值语句等都还未执行）</p>
</li>
<li><p>阶段三：运行（Evaluation），运行代码，计算值，并且将值填充到内存地址中；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/17.jpg" loading="lazy"></p>
<h3 id="阶段一：构建阶段"><a href="#阶段一：构建阶段" class="headerlink" title="阶段一：构建阶段"></a>阶段一：构建阶段</h3><p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/18.jpg" loading="lazy"></p>
<h3 id="阶段二和三：实例化阶段-求值阶段"><a href="#阶段二和三：实例化阶段-求值阶段" class="headerlink" title="阶段二和三：实例化阶段 - 求值阶段"></a>阶段二和三：实例化阶段 - 求值阶段</h3><p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/19.jpg" loading="lazy"></p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>我们能否在 commonjs 或 es module 之间相互引用呢？</p>
<ol>
<li>在 浏览器中 （不能）</li>
<li>node 环境中（区分版本）</li>
<li>平时开发（webpack环境下，是可以任意相互引用的）</li>
</ol>
<h1 id="npm-包管理工具"><a href="#npm-包管理工具" class="headerlink" title="npm 包管理工具"></a>npm 包管理工具</h1><h2 id="代码共享方案"><a href="#代码共享方案" class="headerlink" title="代码共享方案"></a>代码共享方案</h2><ul>
<li><p>我们已经学习了在JavaScript中可以通过模块化的方式将代码划分成一个个小的结构：</p>
<ul>
<li><p>在以后的开发中我们就可以通过模块化的方式来封装自己的代码，并且封装成一个工具； </p>
</li>
<li><p>这个工具我们可以让同事通过导入的方式来使用，甚至你可以分享给世界各地的程序员来使用； </p>
</li>
</ul>
</li>
<li><p><strong>如果我们分享给世界上所有的程序员使用，有哪些方式呢？</strong> </p>
<ul>
<li><p>方式一：<strong>上传到GitHub上、其他程序员通过GitHub下载我们的代码手动的引用</strong>； </p>
</li>
<li><p>缺点是大家必须知道你的代码GitHub的地址，并且从GitHub上手动下载； </p>
</li>
<li><p>需要在自己的项目中手动的引用，并且管理相关的依赖； </p>
</li>
<li><p>不需要使用的时候，需要手动来删除相关的依赖； </p>
</li>
<li><p>当遇到版本升级或者切换时，需要重复上面的操作； </p>
</li>
</ul>
</li>
<li><p>显然，上面的方式是有效的，但是这种传统的方式非常麻烦，并且容易出错；</p>
</li>
<li><p>方式二：<strong>使用一个专业的工具来管理我们的代码</strong></p>
<ul>
<li><p>我们通过工具将代码发布到特定的位置； </p>
</li>
<li><p>其他程序员直接通过工具来安装、升级、删除我们的工具代码； </p>
</li>
</ul>
</li>
<li><p>显然，通过第二种方式我们可以更好的管理自己的工具包，其他人也可以更好的使用我们的工具包。</p>
</li>
</ul>
<h2 id="包管理工具-npm"><a href="#包管理工具-npm" class="headerlink" title="包管理工具 npm"></a>包管理工具 npm</h2><ul>
<li><p><strong>包管理工具npm：</strong> </p>
<ul>
<li><p>Node Package Manager，也就是Node包管理器； </p>
</li>
<li><p>但是目前已经不仅仅是Node包管理器了，在前端项目中我们也在使用它来管理依赖的包；</p>
</li>
<li><p>比如vue、vue-router、vuex、express、koa、react、react-dom、axios、babel、webpack等等；</p>
</li>
</ul>
</li>
<li><p><strong>如何下载npm工具呢？</strong></p>
<ul>
<li><p>npm属于node的一个管理工具，所以我们需要先安装Node； </p>
</li>
<li><p>node管理工具：<a target="_blank" rel="noopener" href="https://nodejs.org/en/">https://nodejs.org/en/</a> </p>
</li>
</ul>
</li>
<li><p><strong>npm管理的包可以在哪里查看、搜索呢？</strong></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.npmjs.org/">https://www.npmjs.org/</a> </p>
</li>
<li><p>这是我们安装相关的npm包的官网；</p>
</li>
</ul>
</li>
<li><p><strong>npm管理的包存放在哪里呢？</strong></p>
<ul>
<li><p>我们发布自己的包其实是发布到registry上面的；</p>
</li>
<li><p>当我们安装一个包时其实是从registry上面下载的包；</p>
</li>
</ul>
</li>
</ul>
<h2 id="npm-的配置文件"><a href="#npm-的配置文件" class="headerlink" title="npm 的配置文件"></a>npm 的配置文件</h2><ul>
<li><p>那么对于一个项目来说，我们如何使用<strong>npm来管理这么多包</strong>呢？</p>
<ul>
<li><p>事实上，我们每一个项目都会有一个对应的配置文件，无论是前端项目（Vue、React）还是后端项目（Node）；</p>
</li>
<li><p>这个配置文件会记录着你项目的名称、版本号、项目描述等；</p>
</li>
<li><p>也会记录着你项目所依赖的其他库的信息和依赖库的版本号； </p>
</li>
</ul>
</li>
<li><p><strong>这个配置文件就是package.json</strong></p>
</li>
<li><p><strong>那么这个配置文件如何得到呢？</strong></p>
<ul>
<li><p>方式一：手动从零创建项目，npm init –y </p>
</li>
<li><p>方式二：通过脚手架创建项目，脚手架会帮助我们生成package.json，并且里面有相关的配置</p>
</li>
</ul>
</li>
<li><p>常见的配置文件</p>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/20.jpg" loading="lazy"></p>
</li>
</ul>
<h2 id="常见的属性"><a href="#常见的属性" class="headerlink" title="常见的属性"></a>常见的属性</h2><ul>
<li><p><strong>必须填写的属性：name、version</strong></p>
<ul>
<li><p>name是项目的名称；</p>
</li>
<li><p>version是当前项目的版本号；</p>
</li>
<li><p>description是描述信息，很多时候是作为项目的基本描述；</p>
</li>
<li><p>author是作者相关信息（发布时用到）；</p>
</li>
<li><p>license是开源协议（发布时用到）；</p>
</li>
</ul>
</li>
<li><p><strong>private属性：</strong></p>
<ul>
<li><p>private属性记录当前的项目是否是私有的；</p>
</li>
<li><p>当值为true时，npm是不能发布它的，这是防止私有项目或模块发布出去的方式；</p>
</li>
</ul>
</li>
<li><p><strong>main属性：</strong></p>
<ul>
<li><p>设置程序的入口。</p>
</li>
<li><p>很多人会有疑惑，webpack不是会自动找到程序的入口吗？</p>
<ul>
<li><p>这个入口和webpack打包的入口并不冲突；</p>
</li>
<li><p>它是在你发布一个模块的时候会用到的；</p>
</li>
<li><p>比如我们使用axios模块 const axios = require(‘axios’);</p>
</li>
<li><p>实际上是找到对应的main属性查找文件的；</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/21.jpg" loading="lazy"></p>
<ul>
<li><p><strong>scripts属性</strong></p>
<ul>
<li><p>scripts属性用于配置一些脚本命令，以键值对的形式存在；</p>
</li>
<li><p>配置后我们可以通过 npm run 命令的key来执行这个命令；</p>
</li>
<li><p>npm start和npm run start的区别是什么？</p>
<ul>
<li><p>它们是等价的；</p>
</li>
<li><p>对于常用的 start、 test、stop、restart可以省略掉run直接通过 npm start等方式运行；</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>dependencies属性</strong></p>
<ul>
<li><p>dependencies属性是指定无论开发环境还是生成环境都需要依赖的包；</p>
</li>
<li><p>通常是我们项目实际开发用到的一些库模块vue、vuex、vue-router、react、react-dom、axios等等；</p>
</li>
<li><p>与之对应的是devDependencies； </p>
</li>
<li><p>在源代码中用到的库，都需要放到 dependencies 中</p>
</li>
<li><p>同时，我们安装对应的包后，包内部还会有这个包的 dependencies</p>
</li>
</ul>
</li>
<li><p><strong>devDependencies属性</strong></p>
<ul>
<li><p>一些包在生成环境是不需要的，比如webpack、babel等；</p>
</li>
<li><p>这个时候我们会通过 npm install webpack –save-dev，将它安装到devDependencies属性中； </p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>实际上，安装的模块安装到什么环境，并不会影响最终打包的结果，因为webpack是会根据依赖图来打包文件的。</p>
</blockquote>
<ul>
<li><p><strong>peerDependencies属性</strong></p>
<ul>
<li><p>还有一种项目依赖关系是对等依赖，也就是你依赖的一个包，它必须是以另外一个宿主包为前提的；</p>
</li>
<li><p>比如element-plus是依赖于vue3的，ant design是依赖于react、react-dom；</p>
</li>
</ul>
</li>
<li><p><strong>engines属性</strong></p>
<ul>
<li><p>engines属性用于指定Node和NPM的版本号；</p>
</li>
<li><p>在安装的过程中，会先检查对应的引擎版本，如果不符合就会报错； </p>
</li>
<li><p>事实上也可以指定所在的操作系统 “os” : [ “darwin”, “linux” ]，只是很少用到；</p>
</li>
</ul>
</li>
<li><p><strong>browserslist属性</strong></p>
<ul>
<li><p>用于配置打包后的JavaScript浏览器的兼容情况，参考； </p>
</li>
<li><p>否则我们需要手动的添加polyfills来让支持某些语法； </p>
</li>
<li><p>也就是说它是为webpack等打包工具服务的一个属性；</p>
</li>
<li><p>某些项目会将其放入到专门的配置文件中</p>
</li>
</ul>
</li>
</ul>
<h2 id="依赖的版本管理"><a href="#依赖的版本管理" class="headerlink" title="依赖的版本管理"></a>依赖的版本管理</h2><ul>
<li><p>我们会发现安装的依赖版本出现：^2.0.3或~2.0.3，这是什么意思呢？</p>
</li>
<li><p>npm的包通常需要遵从semver版本规范：</p>
<ul>
<li><p>semver：<a target="_blank" rel="noopener" href="https://semver.org/lang/zh-CN/">https://semver.org/lang/zh-CN/</a></p>
</li>
<li><p>npm semver：<a target="_blank" rel="noopener" href="https://docs.npmjs.com/misc/semver">https://docs.npmjs.com/misc/semver</a></p>
</li>
</ul>
</li>
<li><p>semver版本规范是X.Y.Z： </p>
<ul>
<li><p>X主版本号（major）：当你做了不兼容的 API 修改（可能不兼容之前的版本）；</p>
</li>
<li><p>Y次版本号（minor）：当你做了向下兼容的功能性新增（新功能增加，但是兼容之前的版本）；</p>
</li>
<li><p>Z修订号（patch）：当你做了向下兼容的问题修正（没有新功能，修复了之前版本的bug）；</p>
</li>
</ul>
</li>
<li><p>我们这里解释一下 ^和~的区别： </p>
<ul>
<li><p>^x.y.z：表示x是保持不变的，y和z永远安装最新的版本；</p>
</li>
<li><p>~x.y.z：表示x和y保持不变的，z永远安装最新的版本；</p>
</li>
</ul>
</li>
<li><p>同时，若项目还存在 package-lock.json 文件时，若 package.json 文件中对应的 模块的版本号与 package-lock.json 中的相同时，便会使用 package-lock.json 中准确的版本号，而不会再安装最新的版本。</p>
</li>
</ul>
<h2 id="npm-install-命令"><a href="#npm-install-命令" class="headerlink" title="npm install 命令"></a>npm install 命令</h2><ul>
<li><p>安装npm包分两种情况： </p>
<ul>
<li><p>全局安装（global install）： npm install webpack -g;</p>
</li>
<li><p>项目（局部）安装（local install）： npm install webpack</p>
</li>
</ul>
</li>
<li><p><strong>全局安装</strong></p>
<ul>
<li><p>全局安装是直接将某个包安装到全局： </p>
</li>
<li><p>比如yarn的全局安装：</p>
</li>
</ul>
<pre class="language-none"><code class="language-none">npm install yarn -g</code></pre></li>
<li><p>但是很多人对全局安装有一些误会：</p>
<ul>
<li><p>通常使用npm全局安装的包都是一些工具包：yarn、webpack等；</p>
</li>
<li><p>并不是类似于 axios、express、koa等库文件；</p>
</li>
<li><p>所以全局安装了之后并不能让我们在所有的项目中使用 axios等库；</p>
</li>
<li><p>全局安装一般适用于简单的使用，真正项目中，一些全局安装后的库还会再做一次局部安装。</p>
</li>
</ul>
</li>
</ul>
<h2 id="项目安装"><a href="#项目安装" class="headerlink" title="项目安装"></a>项目安装</h2><ul>
<li><p>局部安装分为开发时依赖和生产时依赖：</p>
</li>
<li><p><strong>项目安装</strong></p>
<ul>
<li><p> 安装开发和生产依赖</p>
</li>
<li><p>npm install axios</p>
</li>
<li><p>npm i axios</p>
</li>
<li><p>npm i axios –save</p>
</li>
<li><p>安装开发依赖</p>
<ul>
<li><p>npm install webpack –save-dev</p>
</li>
<li><p>npm install webpack -D</p>
</li>
<li><p>npm i webpack –D </p>
</li>
</ul>
</li>
<li><p>根据package.json中的依赖包安装</p>
<ul>
<li>npm install</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="npm-install-原理"><a href="#npm-install-原理" class="headerlink" title="npm install 原理"></a>npm install 原理</h2><ul>
<li><p>很多同学之前应该已经会了 npm install <code>&lt;package&gt;</code>，但是你是否思考过它的内部原理呢？</p>
<ul>
<li><p>执行 npm install它背后帮助我们完成了什么操作？</p>
</li>
<li><p>我们会发现还有一个成为package-lock.json的文件，它的作用是什么？</p>
</li>
<li><p>从npm5开始，npm支持缓存策略（来自yarn的压力），缓存有什么作用呢？</p>
</li>
</ul>
</li>
<li><p>这是一幅我画出的根据 npm install 的原理图（注意：压缩到改为加压到）：</p>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/22.jpg" loading="lazy"></p>
<ul>
<li><p>若要安装的模块原本的版本是 0.24.1，而我们安装时对其指定了版本：npm install <a href="mailto:&#x78;&#120;&#120;&#64;&#x30;&#x2e;&#x32;&#x36;&#46;&#x31;">&#x78;&#120;&#120;&#64;&#x30;&#x2e;&#x32;&#x36;&#46;&#x31;</a>，那么在检测依赖一致性时，会发现不一致，于是便会重新下载压缩包，解压后，重新生成 package-lock.json 文件。</p>
</li>
<li><p>如果检测依赖一致性发现一致时，则会查找缓存，将查找到的缓存文件进行获取</p>
<p>可以根据 <code>npm get cache</code> 来获取缓存路径。</p>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/23.jpg" loading="lazy"></p>
</li>
</ul>
<p><strong>原理图解析：</strong></p>
<ul>
<li><p>npm install会检测是否有package-lock.json文件：</p>
<ul>
<li><p>没有lock文件</p>
<ul>
<li><p>分析依赖关系，这是因为我们可能包会依赖其他的包，并且多个包之间会产生相同依赖的情况； </p>
</li>
<li><p>从registry仓库中下载压缩包（如果我们设置了镜像，那么会从镜像服务器下载压缩包）；</p>
</li>
<li><p>获取到压缩包后会对压缩包进行缓存（从npm5开始有的）；</p>
</li>
<li><p>将压缩包解压到项目的node_modules文件夹中（前面我们讲过，require的查找顺序会在该包下面查找）</p>
</li>
</ul>
</li>
<li><p>有lock文件</p>
<ul>
<li>检测lock中包的版本是否和package.json中一致（会按照semver版本规范检测）；<ul>
<li>不一致，那么会重新构建依赖关系，直接会走顶层的流程；</li>
<li>一致的情况下，会去优先查找缓存<ul>
<li>没有找到，会从registry仓库下载，直接走顶层流程；</li>
<li>查找到，会获取缓存中的压缩文件，并且将压缩文件解压到node_modules文件夹中；</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>package-lock.json</strong></p>
<ul>
<li><p>package-lock.json文件解析：</p>
</li>
<li><p>name：项目的名称；</p>
</li>
<li><p>version：项目的版本；</p>
</li>
<li><p>lockfileVersion：lock文件的版本；</p>
</li>
<li><p>requires：使用requires来跟踪模块的依赖关系；</p>
</li>
<li><p>dependencies：项目的依赖</p>
<ul>
<li><p>当前项目依赖axios，但是axios依赖follow-redireacts； </p>
</li>
<li><p>axios中的属性如下：</p>
<ul>
<li><p>version表示实际安装的axios的版本；</p>
</li>
<li><p>resolved用来记录下载的地址，registry仓库中的位置；</p>
</li>
<li><p>requires记录当前模块的依赖；</p>
</li>
<li><p>integrity用来从缓存中获取索引，再通过索引去获取压缩包文件；</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/24.jpg" loading="lazy"></p>
<h2 id="npm-其他命令"><a href="#npm-其他命令" class="headerlink" title="npm 其他命令"></a>npm 其他命令</h2><ul>
<li><p><strong>我们这里再介绍几个比较常用的：</strong></p>
</li>
<li><p>卸载某个依赖包：</p>
</li>
</ul>
<pre class="language-none"><code class="language-none">npm uninstall package
npm uninstall package --save-dev
npm uninstall package -D</code></pre>

<ul>
<li>强制重新build</li>
</ul>
<pre class="language-none"><code class="language-none">npm rebuild</code></pre>

<ul>
<li>清除缓存</li>
</ul>
<pre class="language-none"><code class="language-none">npm cache clean</code></pre>

<ul>
<li><p>npm的命令其实是非常多的：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.npmjs.com/cli-documentation/cli">https://docs.npmjs.com/cli-documentation/cli</a></p>
</li>
<li><p>更多的命令，可以根据需要查阅官方文档</p>
</li>
</ul>
</li>
</ul>
<h2 id="yarn-工具"><a href="#yarn-工具" class="headerlink" title="yarn 工具"></a>yarn 工具</h2><ul>
<li><p><strong>另一个node包管理工具yarn：</strong> </p>
<ul>
<li><p>yarn是由Facebook、Google、Exponent 和 Tilde 联合推出了一个新的 JS 包管理工具；</p>
</li>
<li><p>yarn 是为了弥补 npm 的一些缺陷而出现的；</p>
</li>
<li><p>早期的npm存在很多的缺陷，比如安装依赖速度很慢、版本依赖混乱（两个包若依赖了一个相同的包，那么这个包会被下载两次）等等一系列的问题；</p>
</li>
<li><p>虽然从npm5版本开始，进行了很多的升级和改进，但是依然很多人喜欢使用yarn；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/25.jpg" loading="lazy"></p>
<ul>
<li>注意：yarn 和 npm 不能混用。否则在 lock 文件中会出现管理混乱的问题。</li>
</ul>
<h2 id="cnpm-工具"><a href="#cnpm-工具" class="headerlink" title="cnpm 工具"></a>cnpm 工具</h2><ul>
<li><p>由于一些特殊的原因，某些情况下我们没办法很好的从 <a target="_blank" rel="noopener" href="https://registry.npmjs.org下载下来一些需要的包./">https://registry.npmjs.org下载下来一些需要的包。</a></p>
</li>
<li><p>查看npm镜像：</p>
</li>
</ul>
<pre class="language-none"><code class="language-none">npm config get registry</code></pre>

<ul>
<li>我们可以直接设置npm的镜像：</li>
</ul>
<pre class="language-none"><code class="language-none">npm config set registry https:&#x2F;&#x2F;registry.npm.taobao.org</code></pre>

<ul>
<li><p>但是对于大多数人来说（比如我），并不希望将npm镜像修改了：</p>
<ul>
<li><p>第一，不太希望随意修改npm原本从官方下来包的渠道；</p>
</li>
<li><p>第二，担心某天淘宝的镜像挂了或者不维护了，又要改来改去；</p>
</li>
<li><p>第三，镜像服务器同步包是由延迟的，我们可能无法获取到最新的包。</p>
</li>
</ul>
</li>
<li><p>这个时候，我们可以使用cnpm，并且将cnpm设置为淘宝的镜像：</p>
</li>
</ul>
<pre class="language-none"><code class="language-none">npm install -g cnpm --registry&#x3D;https:&#x2F;&#x2F;registry.npm.taobao.org
cnpm config get registry # https:&#x2F;&#x2F;registry.npm.taobao.org&#x2F;</code></pre>

<ul>
<li>此后，我们便可以在 npm 与 cnpm 之间来回切换，根据自己的需要选择下载的工具</li>
</ul>
<h2 id="npx-工具"><a href="#npx-工具" class="headerlink" title="npx 工具"></a>npx 工具</h2><ul>
<li><p>npx是npm5.2之后自带的一个命令。 </p>
<ul>
<li>npx的作用非常多，但是比较常见的是使用它来调用项目中的某个模块的指令。 </li>
</ul>
</li>
<li><p>我们以webpack为例： </p>
<ul>
<li><p>全局安装的是webpack5.1.3</p>
</li>
<li><p>项目安装的是webpack3.6.0</p>
</li>
</ul>
</li>
<li><p>如果我在终端执行 webpack –version使用的是哪一个命令呢？</p>
<ul>
<li><p>显示结果会是 webpack 5.1.3，事实上使用的是全局的，为什么呢？</p>
</li>
<li><p>原因非常简单，在当前目录下找不到webpack时，就会去全局找，并且执行命令； </p>
</li>
</ul>
</li>
</ul>
<h2 id="局部命令的执行"><a href="#局部命令的执行" class="headerlink" title="局部命令的执行"></a>局部命令的执行</h2><ul>
<li><p>那么如何使用项目（局部）的webpack，常见的是两种方式：</p>
<ul>
<li><p>方式一：明确查找到node_module下面的webpack</p>
</li>
<li><p>方式二：在 scripts定义脚本，来执行webpack； </p>
</li>
</ul>
</li>
<li><p>方式一：在终端中使用如下命令（在项目根目录下）</p>
<pre class="language-none"><code class="language-none">.&#x2F;node_modules&#x2F;.bin&#x2F;webpack --version</code></pre></li>
<li><p>方式二：修改package.json中的scripts</p>
<pre class="language-none"><code class="language-none">&quot;scripts&quot;: &#123;
	&quot;webpack&quot;: &quot;webpack --version&quot;
&#125;</code></pre>

<p>之后使用 npm run webpack</p>
</li>
<li><p>方式三：使用npx</p>
<pre class="language-none"><code class="language-none">npx webpack --version</code></pre></li>
<li><p>npx的原理非常简单，它会到当前目录的node_modules/.bin目录下查找对应的命令；</p>
</li>
</ul>
<h2 id="npm-发布自己的包"><a href="#npm-发布自己的包" class="headerlink" title="npm 发布自己的包"></a>npm 发布自己的包</h2><ul>
<li><p>注册npm账号：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a></p>
</li>
<li><p> 选择sign up</p>
</li>
</ul>
</li>
<li><p>在命令行登录：</p>
<pre class="language-none"><code class="language-none">npm login</code></pre></li>
<li><p>修改package.json</p>
</li>
<li><p>发布到npm registry上 </p>
<pre class="language-none"><code class="language-none">npm publish</code></pre></li>
<li><p>更新仓库：</p>
<ol>
<li><p>修改版本号(最好符合semver规范) </p>
</li>
<li><p>重新发布 npm publish</p>
</li>
</ol>
</li>
<li><p>删除发布的包：</p>
<pre class="language-none"><code class="language-none">npm unpublish</code></pre></li>
<li><p>让发布的包过期：</p>
<pre class="language-none"><code class="language-none">npm deprecate</code></pre></li>
</ul>
<h1 id="JSON-storage"><a href="#JSON-storage" class="headerlink" title="JSON-storage"></a>JSON-storage</h1><h2 id="JSON-的由来"><a href="#JSON-的由来" class="headerlink" title="JSON 的由来"></a>JSON 的由来</h2><ul>
<li><p>在目前的开发中，JSON是一种非常重要的<strong>数据格式</strong>，它并<strong>不是编程语言</strong>，而是一种可以在服务器和客户端之间传输的数据格式。</p>
</li>
<li><p>JSON的全称是JavaScript Object Notation（JavaScript对象符号）：</p>
<ul>
<li><p>JSON是由Douglas Crockford构想和设计的一种轻量级资料交换格式，算是JavaScript的一个子集；</p>
</li>
<li><p>但是虽然JSON被提出来的时候是主要应用JavaScript中，但是目前已经独立于编程语言，可以在各个编程语言中使用；</p>
</li>
<li><p>很多编程语言都实现了将JSON转成对应模型的方式；</p>
</li>
</ul>
</li>
<li><p><strong>其他的传输格式：</strong></p>
</li>
<li><p>XML：在早期的网络传输中主要是使用XML来进行数据交换的，但是这种格式在解析、传输等各方面都弱于JSON，所以目前已经很少在被使用了；</p>
</li>
<li><p>Protobuf：另外一个在网络传输中目前已经越来越多使用的传输格式是protobuf，但是直到2021年的3.x版本才支持JavaScript，所以目前在前端使用的较少；</p>
</li>
<li><p>目前JSON被使用的场景也越来越多：</p>
<ul>
<li><p>网络数据的传输JSON数据；</p>
</li>
<li><p>项目的某些配置文件；</p>
</li>
<li><p>非关系型数据库（NoSQL）将json作为存储格式；</p>
</li>
</ul>
</li>
</ul>
<h2 id="JSON基本语法"><a href="#JSON基本语法" class="headerlink" title="JSON基本语法"></a>JSON基本语法</h2><ul>
<li><p>JSON的顶层支持三种类型的值：</p>
<ul>
<li><p>简单值：数字（Number）、字符串（String，不支持单引号）、布尔类型（Boolean）、null类型；</p>
<p>不支持 undefined</p>
</li>
<li><p>对象值：由key、value组成，key是字符串类型，并且必须添加双引号，值可以是简单值、对象值、数组值；</p>
</li>
<li><p>数组值：数组的值可以是简单值、对象值、数组值；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token string">"abc"</span></code></pre>

<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"why"</span><span class="token punctuation">,</span>
  <span class="token property">"age"</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  <span class="token property">"friend"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"kobe"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token property">"hobbies"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"篮球"</span><span class="token punctuation">,</span> <span class="token string">"足球"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token string">"abc"</span><span class="token punctuation">,</span>
  <span class="token number">123</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"kobe"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span></code></pre>

<ul>
<li>注意： JSON 中不可以加注释。且最后的位置不可以加 “，”。</li>
</ul>
<h2 id="JSON-的序列化"><a href="#JSON-的序列化" class="headerlink" title="JSON 的序列化"></a>JSON 的序列化</h2><ul>
<li><p>某些情况下我们希望将JavaScript中的复杂类型转化成JSON格式的字符串，这样方便对其进行处理：</p>
<ul>
<li><p>比如我们希望将一个对象保存到localStorage中；</p>
</li>
<li><p>但是如果我们直接存放一个对象，这个对象会被转化成 [object Object] 格式的字符串，并不是我们想要的结果；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/26.jpg" loading="lazy"></p>
<ul>
<li><p>在ES5中引用了JSON全局对象，该对象有两个常用的方法：</p>
<ul>
<li><p>stringify方法：将JavaScript类型转成对应的JSON字符串；</p>
</li>
<li><p>parse方法：解析JSON字符串，转回对应的JavaScript类型；</p>
</li>
</ul>
</li>
<li><p>那么上面的代码我们可以通过如下的方法来使用：</p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token string">"why"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  friends<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token string">"kobe"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  hobbies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"篮球"</span><span class="token punctuation">,</span> <span class="token string">"足球"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 将obj转成JSON格式的字符串</span>
<span class="token keyword">const</span> objString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token comment">// 将对象数据存储localStorage</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">"obj"</span><span class="token punctuation">,</span> objString<span class="token punctuation">)</span>

<span class="token keyword">const</span> jsonString <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"obj"</span><span class="token punctuation">)</span>

<span class="token comment">// 将JSON格式的字符串转回对象</span>
<span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span></code></pre>

<h2 id="Stringify-的参数"><a href="#Stringify-的参数" class="headerlink" title="Stringify 的参数"></a>Stringify 的参数</h2><ul>
<li><p><strong>JSON.stringify()</strong> 方法将一个 JavaScript 对象或值转换为 JSON 字符串。其还包含两个参数，第二个参数：</p>
<ul>
<li><p>如果指定了一个 replacer 函数，则可以选择性地替换值；</p>
</li>
<li><p>如果指定的 replacer 是数组，则可选择性地仅包含数组指定的属性；</p>
</li>
</ul>
</li>
<li><p>当然，它还可以跟上第三个参数space： </p>
<ul>
<li>这个参数可以为转换出来的字符串设置对应的分隔符</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token string">"why"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  friends<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token string">"kobe"</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  hobbies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"篮球"</span><span class="token punctuation">,</span> <span class="token string">"足球"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 需求: 将上面的对象转成JSON字符串</span>
<span class="token comment">// 1.直接转化</span>
<span class="token keyword">const</span> jsonString1 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonString1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;"name":"why","age":18,"friends":&#123;"name":"kobe"&#125;,"hobbies":["篮球","足球"]&#125;</span>

<span class="token comment">// 2.stringify第二个参数replacer</span>
<span class="token comment">// 2.1. 传入数组: 设定哪些是需要转换</span>
<span class="token keyword">const</span> jsonString2 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"friends"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonString2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;"name":"why","friends":&#123;"name":"kobe"&#125;&#125;</span>

<span class="token comment">// 2.2. 传入回调函数:</span>
<span class="token keyword">const</span> jsonString3 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">"age"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonString3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;"name":"why","age":19,"friends":&#123;"name":"kobe"&#125;,"hobbies":["篮球","足球"]&#125;</span>

<span class="token comment">// 3.stringify第三参数 space(可以是string或number，为number时会留出对应数字的空格，为 string时会用相关的 string作为分隔符)</span>
<span class="token keyword">const</span> jsonString4 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonString4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
&#123;
  "name": "why",
  "age": 18,
  "friends": &#123;
    "name": "kobe"
  &#125;,
  "hobbies": [
    "篮球",
    "足球"
  ]
&#125;
*/</span>
<span class="token keyword">const</span> jsonString5 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonString5<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
&#123;
---"name": "why",
---"age": 18,
---"friends": &#123;
------"name": "kobe"
---&#125;,
---"hobbies": [
------"篮球",
------"足球"
---]
&#125;
*/</span></code></pre>



<ul>
<li>如果对象本身包含toJSON方法，那么会直接使用toJSON方法的结果：</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/27.jpg" loading="lazy"></p>
<h2 id="parse方法"><a href="#parse方法" class="headerlink" title="parse方法"></a>parse方法</h2><ul>
<li><strong>JSON.parse()</strong> 方法用来解析JSON字符串，构造由字符串描述的JavaScript值或对象。<ul>
<li>同时其第二个参数提供了可选的 <strong>reviver</strong> 函数用以在返回之前对所得到的对象执行变换(操作)。</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> JSONString <span class="token operator">=</span>
  <span class="token string">'&#123;"name":"why","age":19,"friends":&#123;"name":"kobe"&#125;,"hobbies":["篮球","足球"]&#125;'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>JSONString<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">"age"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> value <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
&#123;
  name: 'why',
  age: 18,
  friends: &#123; name: 'kobe' &#125;,
  hobbies: [ '篮球', '足球' ]
&#125;
*/</span></code></pre>

<h2 id="使用-JSON-进行深拷贝"><a href="#使用-JSON-进行深拷贝" class="headerlink" title="使用 JSON 进行深拷贝"></a>使用 JSON 进行深拷贝</h2><ul>
<li><p>使用JSON序列化与反序列化生成的新对象和之前的对象并不是同一个对象：</p>
<ul>
<li>相当于是进行了一次深拷贝；</li>
</ul>
</li>
<li><p>注意：这种方法它对函数是无能为力的</p>
<ul>
<li>创建出来的info中是没有foo函数的，这是因为stringify并不会对函数进行处理；</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token string">"why"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  friends<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token string">"kobe"</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  hobbies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"篮球"</span><span class="token punctuation">,</span> <span class="token string">"足球"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"foo function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 此种方式虽然可以实现深拷贝，但若对象中有函数，则无法成功转换，函数会被直接移除，因为JSON中是不支持函数的。</span>
<span class="token comment">// 将obj对象的内容放到info变量中</span>
<span class="token comment">// 1.引用赋值</span>
<span class="token keyword">const</span> info <span class="token operator">=</span> obj<span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span>

<span class="token comment">// 2.浅拷贝</span>
<span class="token keyword">const</span> info2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>obj <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 或者使用 Object.assign</span>
obj<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info2<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span>

obj<span class="token punctuation">.</span>friends<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"james"</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info2<span class="token punctuation">.</span>friends<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// james</span>

<span class="token comment">// 3.stringify和parse来实现</span>
<span class="token keyword">const</span> jsonString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;"name":"why","age":1000,"friends":&#123;"name":"james"&#125;,"hobbies":["篮球","足球"]&#125;</span>
<span class="token keyword">const</span> info3 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>friends<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"curry"</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info3<span class="token punctuation">.</span>friends<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// james</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
&#123;
  name: 'why',
  age: 1000,
  friends: &#123; name: 'james' &#125;,
  hobbies: [ '篮球', '足球' ]
&#125;
*/</span>
</code></pre>



<h2 id="认识Storage"><a href="#认识Storage" class="headerlink" title="认识Storage"></a>认识Storage</h2><ul>
<li><p>WebStorage主要提供了一种机制，可以让浏览器提供一种比cookie更直观的key、value存储方式：</p>
<ul>
<li><p>localStorage：本地存储，提供的是一种永久性的存储方法，在关闭掉网页重新打开时，存储的内容依然保留； </p>
</li>
<li><p>sessionStorage：会话存储，提供的是本次会话的存储，在关闭掉会话时，存储的内容会被清除；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/28.jpg" loading="lazy"></p>
<h2 id="localStorage-和-sessionStorage-的区别"><a href="#localStorage-和-sessionStorage-的区别" class="headerlink" title="localStorage 和 sessionStorage 的区别"></a>localStorage 和 sessionStorage 的区别</h2><ul>
<li><p>我们会发现localStorage和sessionStorage看起来非常的相似。 </p>
</li>
<li><p>那么它们有什么区别呢？</p>
<ul>
<li><p>验证一：关闭网页后重新打开，localStorage会保留，而sessionStorage会被删除； </p>
</li>
<li><p>验证二：在页面内实现跳转，localStorage会保留，sessionStorage也会保留； </p>
</li>
<li><p>验证三：在页面外实现跳转（打开新的网页），localStorage会保留(存在于同一个域下)，sessionStorage不会被保留；</p>
</li>
</ul>
</li>
</ul>
<h2 id="Storage常见的方法和属性"><a href="#Storage常见的方法和属性" class="headerlink" title="Storage常见的方法和属性"></a>Storage常见的方法和属性</h2><ul>
<li><p><strong>Storage有如下的属性和方法：</strong></p>
</li>
<li><p>属性：</p>
<ul>
<li>Storage.length：只读属性<ul>
<li>返回一个整数，表示存储在Storage对象中的数据项数量； </li>
</ul>
</li>
</ul>
</li>
<li><p>方法：</p>
<ul>
<li><p>Storage.key()：该方法接受一个数值n作为参数，返回存储中的第n个key名称； </p>
</li>
<li><p>Storage.getItem()：该方法接受一个key作为参数，并且返回key对应的value； </p>
</li>
<li><p>Storage.setItem()：该方法接受一个key和value，并且将会把key和value添加到存储中。</p>
<ul>
<li>如果key存储，则更新其对应的值；</li>
</ul>
</li>
<li><p>Storage.removeItem()：该方法接受一个key作为参数，并把该key从存储中删除； </p>
</li>
<li><p>Storage.clear()：该方法的作用是清空存储中的所有key；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1.setItem</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"coderwhy"</span><span class="token punctuation">)</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// 2.length</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> localStorage<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 3.key方法</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 4.getItem(key)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 5.removeItem</span>
localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span>

<span class="token comment">// 6.clear方法</span>
localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<h2 id="Storage-工具库的封装"><a href="#Storage-工具库的封装" class="headerlink" title="Storage 工具库的封装"></a>Storage 工具库的封装</h2><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">HYCache</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">isLocal <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>storage <span class="token operator">=</span> isLocal <span class="token operator">?</span> localStorage<span class="token operator">:</span> sessionStorage
  <span class="token punctuation">&#125;</span>

  <span class="token function">setItem</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">getItem</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">&#125;</span> 
  <span class="token punctuation">&#125;</span><span class="token number">2</span>

  <span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">key</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span>length
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> localCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HYCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> sessionCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HYCache</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token punctuation">&#123;</span>
  localCache<span class="token punctuation">,</span>
  sessionCache
<span class="token punctuation">&#125;</span></code></pre>



<h2 id="认识-IndexDB"><a href="#认识-IndexDB" class="headerlink" title="认识 IndexDB"></a>认识 IndexDB</h2><ul>
<li><p>什么是IndexedDB呢？</p>
<ul>
<li><p>我们能看到DB这个词，就说明它其实是一种数据库（Database），通常情况下在服务器端比较常见；</p>
</li>
<li><p>在实际的开发中，大量的数据都是存储在数据库的，客户端主要是请求这些数据并且展示；</p>
</li>
<li><p>有时候我们可能会存储一些简单的数据到本地（浏览器中），比如token、用户名、密码、用户信息等，比较少存储大量的数据；</p>
</li>
<li><p>那么如果确实有大量的数据需要存储，这个时候可以选择使用IndexedDB； </p>
</li>
</ul>
</li>
<li><p>IndexedDB是一种底层的API，用于在客户端存储大量的结构化数据。</p>
<ul>
<li><p>它是一种事务型数据库系统（通过事务将一系列的操作看成一个整体），是一种基于JavaScript面向对象数据库，有点类似于NoSQL（非关系型数据库）；</p>
</li>
<li><p>IndexDB本身就是基于事务的，我们只需要指定数据库模式，打开与数据库的连接，然后检索和更新一系列事务即可；</p>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/29.jpg" loading="lazy"></p>
</li>
</ul>
<h2 id="IndexdDB-连接数据库"><a href="#IndexdDB-连接数据库" class="headerlink" title="IndexdDB 连接数据库"></a>IndexdDB 连接数据库</h2><ul>
<li><p>第一步：打开indexDB的某一个数据库；</p>
<ul>
<li><p>通过indexDB.open(数据库名称, 数据库版本)方法；</p>
</li>
<li><p>如果数据库不存在，那么会创建这个数据；</p>
</li>
<li><p>如果数据库已经存在，那么会打开这个数据库；</p>
</li>
</ul>
</li>
<li><p>第二步：通过监听回调得到数据库连接结果；</p>
<ul>
<li><p>数据库的open方法会得到一个<strong>IDBOpenDBRequest</strong>类型</p>
</li>
<li><p>我们可以通过下面的三个回调来确定结果：</p>
<ul>
<li><p>onerror：当数据库连接失败时；</p>
</li>
<li><p>onsuccess：当数据库连接成功时回调；</p>
</li>
<li><p>onupgradeneeded：当数据库的version发生变化并且高于之前版本时回调；</p>
<ul>
<li>通常我们在这里会创建具体的存储对象：db.createObjectStore(存储对象名称, { keypath: 存储的主键 })</li>
</ul>
</li>
</ul>
</li>
<li><p>我们可以通过onsuccess回调的event获取到db对象：event.target.result</p>
</li>
</ul>
</li>
</ul>
<h2 id="IndexDB-的数据库操作"><a href="#IndexDB-的数据库操作" class="headerlink" title="IndexDB 的数据库操作"></a>IndexDB 的数据库操作</h2><ul>
<li><p>我们对数据库的操作要通过事务对象来完成：</p>
<ul>
<li><p>第一步：通过db获取对应存储的事务 db.transaction(存储名称, 可写操作)； </p>
</li>
<li><p>第二步：通过事务获取对应的存储对象 transaction.objectStore(存储名称)； </p>
</li>
</ul>
</li>
<li><p>接下来我们就可以进行增删改查操作了：</p>
<ul>
<li><p>新增数据 store.add</p>
</li>
<li><p>查询数据</p>
<ul>
<li><p>方式一：store.get(key)</p>
</li>
<li><p>方式二：通过 store.openCursor 拿到游标对象</p>
<ul>
<li><p>在request.onsuccess中获取cursor：event.target.result</p>
</li>
<li><p>获取对应的key：cursor.key； </p>
</li>
<li><p>获取对应的value：cursor.value； </p>
</li>
<li><p>可以通过cursor.continue来继续执行；</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>修改数据 cursor.update(value)</p>
</li>
<li><p>删除数据 cursor.delete()</p>
</li>
</ul>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 打开数据(和数据库建立连接)</span>
<span class="token keyword">const</span> dbRequest <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"why"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dbRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"打开数据库失败~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
dbRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 第一次打开/或者版本发生升级</span>
dbRequest<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 创建一些存储对象，第二个参数为表的主键</span>
  db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> keyPath<span class="token operator">:</span> <span class="token string">"id"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"why"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">"kobe"</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">"james"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 获取btns, 监听点击</span>
<span class="token keyword">const</span> btns <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> btns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  btns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 创建事务对象，第一个参数为表名（也可以传数组），第二个参数为模式</span>
    <span class="token keyword">const</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token string">"readwrite"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 为了避免 db.transaction 的第一个参数是数组的情况，所以需要用 transaction.objectStore 来再明确获取一下 store 对象</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"点击了新增"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> user <span class="token keyword">of</span> users<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
          request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">插入成功</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        transaction<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"添加操作全部完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"点击了查询"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 1.查询方式一(知道主键, 根据主键查询)</span>
        <span class="token comment">// const request = store.get(102)</span>
        <span class="token comment">// request.onsuccess = function(event) &#123;</span>
        <span class="token comment">//   console.log(event.target.result)</span>
        <span class="token comment">// &#125;</span>

        <span class="token comment">// 2.查询方式二:</span>
        <span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">const</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token number">101</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>key<span class="token punctuation">,</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
              cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"查询完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"点击了删除"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注意：此处不能再起名为 request，会和 case 1 中的名字冲突</span>
        <span class="token keyword">const</span> deleteRequest <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        deleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">const</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token number">101</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              cursor<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
              cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"查询完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"点击了修改"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> updateRequest <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        updateRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">const</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token number">101</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              <span class="token keyword">const</span> value <span class="token operator">=</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
              value<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"curry"</span><span class="token punctuation">;</span>
              cursor<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
              cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"查询完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h1 id="Cookie-DOM-BOM"><a href="#Cookie-DOM-BOM" class="headerlink" title="Cookie-DOM-BOM"></a>Cookie-DOM-BOM</h1><h2 id="认识Cookie"><a href="#认识Cookie" class="headerlink" title="认识Cookie"></a>认识Cookie</h2><ul>
<li><p><strong>Cookie</strong>（复数形态Cookies），又称为“小甜饼”。类型为“<strong>小型文本文件</strong>，某些网站为了辨别用户身份而存储在用户本地终端（Client Side）上的数据。</p>
<ul>
<li>浏览器会在特定的情况下携带上cookie来发送请求，我们可以通过cookie来获取一些信息；</li>
</ul>
</li>
<li><p>Cookie总是保存在客户端中，按在客户端中的存储位置，Cookie可以分为内存Cookie和硬盘Cookie。 </p>
<ul>
<li><p>内存Cookie由浏览器维护，保存在内存中，浏览器关闭时Cookie就会消失，其存在时间是短暂的；</p>
</li>
<li><p>硬盘Cookie保存在硬盘中，有一个过期时间，用户手动清理或者过期时间到时，才会被清理；</p>
</li>
</ul>
</li>
<li><p>如果判断一个cookie是内存cookie还是硬盘cookie呢？</p>
<ul>
<li><p>没有设置过期时间，默认情况下cookie是内存cookie，在关闭浏览器时会自动删除；</p>
</li>
<li><p>有设置过期时间，并且过期时间不为0或者负数的cookie，是硬盘cookie，需要手动或者到期时，才会删除；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/30.jpg" loading="lazy"></p>
<ul>
<li>当浏览器发现响应头里有一个 Set-Cookie 后，浏览器会自动读取set-cookie，并且将 cookie 保存到客户端上。</li>
</ul>
<h2 id="cookie-常见的属性"><a href="#cookie-常见的属性" class="headerlink" title="cookie 常见的属性"></a>cookie 常见的属性</h2><ul>
<li><p><strong>cookie的生命周期：</strong></p>
<ul>
<li><p>默认情况下的cookie是内存cookie，也称之为会话cookie，也就是在浏览器关闭时会自动被删除；</p>
</li>
<li><p>我们可以通过设置<em>expires</em>或者<em>max-age</em>来设置过期的时间；</p>
<ul>
<li><p>expires：设置的是Date.toUTCString()，设置格式是;expires=date-in-GMTString-format； </p>
</li>
<li><p>max-age：设置过期的秒钟，;max-age=max-age-in-seconds (例如一年为60<strong>60</strong>24*365)； </p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>cookie的作用域：（允许cookie发送给哪些URL）</strong> </p>
<ul>
<li><p>Domain：指定哪些主机可以接受cookie</p>
<ul>
<li><p>如果不指定，那么默认是 origin，不包括子域名。（此时baidu.com 的 cookie 不能传递到 news.baidu.com）</p>
</li>
<li><p>如果指定Domain，则包含子域名。例如，如果设置 Domain=mozilla.org，则 Cookie 也包含在子域名中（如developer.mozilla.org）。</p>
</li>
</ul>
</li>
<li><p>Path：指定主机下哪些路径可以接受cookie</p>
<ul>
<li>例如，设置 Path=/docs，则以下地址都会匹配：<ul>
<li>/docs</li>
<li>/docs/Web/</li>
<li>/docs/Web/HTTP</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="客户端设置-Cookie"><a href="#客户端设置-Cookie" class="headerlink" title="客户端设置 Cookie"></a>客户端设置 Cookie</h2><ul>
<li>客户端无法直接通过 document.cookie 获取服务器设置的 cookie。但是可以通过它设置 cookie。</li>
<li>同时若想要删除 服务器传过来的 cookie，需要确保服务器传来的 cookie 的 httpOnly 属性为 false。然后便可以通过 document.cookie=”name=why;max-age=0” 来删除 cookie。</li>
</ul>
<h2 id="Cookie-的缺点"><a href="#Cookie-的缺点" class="headerlink" title="Cookie 的缺点"></a>Cookie 的缺点</h2><ol>
<li>会将 cookie 附加到每一次的 http 请求中。而有一些请求是不需要携带的。所以这样会浪费流量。</li>
<li>其是明文传输的，容易暴露隐私信息。</li>
<li>有大小限制：4kb</li>
<li>cookie 验证登录，某一些客户端可能无法设置cookie。</li>
</ol>
<ul>
<li>现在一般情况下做登录会使用 token，服务器会为我们通过对称加密或非对称加密生成 token。之后客户端根据请求是否需要登录，来判断是否需要携带 token。</li>
</ul>
<h2 id="认识BOM"><a href="#认识BOM" class="headerlink" title="认识BOM"></a>认识BOM</h2><ul>
<li><p>JavaScript有一个非常重要的运行环境就是浏览器，而且浏览器本身又作为一个应用程序需要对其本身进行操作，所以通常浏览器会有对应的对象模型（BOM，Browser Object Model）。</p>
<ul>
<li>我们可以将BOM看成是连接JavaScript脚本与浏览器窗口的桥梁。</li>
</ul>
</li>
<li><p>BOM主要包括一下的对象模型：</p>
<ul>
<li><p>window：包括全局属性、方法，控制浏览器窗口相关的属性、方法；</p>
</li>
<li><p>location：浏览器连接到的对象的位置（URL）；</p>
</li>
<li><p>history：操作浏览器的历史；</p>
</li>
<li><p>document：当前窗口操作文档的对象；</p>
</li>
</ul>
</li>
<li><p>window对象在浏览器中有两个身份：</p>
<ul>
<li><p>身份一：全局对象。</p>
<ul>
<li><p>我们知道ECMAScript其实是有一个全局对象的，这个全局对象在Node中是global； </p>
</li>
<li><p>在浏览器中就是window对象；</p>
</li>
</ul>
</li>
<li><p>身份二：浏览器窗口对象。</p>
<ul>
<li>作为浏览器窗口时，提供了对浏览器操作的相关的API；</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>window全局对象</strong></p>
<ul>
<li><p>在浏览器中，window对象就是之前经常提到的全局对象，也就是我们之前提到过GO对象：</p>
<ul>
<li><p>比如在全局通过var声明的变量，会被添加到GO中，也就是会被添加到window上；</p>
</li>
<li><p>window默认给我们提供了全局的函数和类：setTimeout、Math、Date、Object等；</p>
</li>
</ul>
</li>
<li><p>通过var声明的变量，全局提供的类和方法：</p>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/31.jpg" loading="lazy"></p>
<ul>
<li>这些用法是我们之前讲过的，并且也是作为JavaScript语言本身所拥有的一些特性。<ul>
<li>那么接下来我们来看一下作为窗口对象，它拥有哪些特性。</li>
</ul>
</li>
</ul>
<h2 id="Window-窗口对象"><a href="#Window-窗口对象" class="headerlink" title="Window 窗口对象"></a>Window 窗口对象</h2><ul>
<li><p>事实上window对象上肩负的重担是非常大的：</p>
<ul>
<li><p>第一：包含大量的属性，localStorage、console、location、history、screenX、scrollX等等（大概60+个属性）；</p>
</li>
<li><p>第二：包含大量的方法，alert、close、scrollTo、open等等（大概40+个方法）；</p>
</li>
<li><p>第三：包含大量的事件，focus、blur、load、hashchange等等（大概30+个事件）；</p>
</li>
<li><p>第四：包含从EventTarget继承过来的方法，addEventListener、removeEventListener、dispatchEvent方法；</p>
</li>
</ul>
</li>
<li><p>那么这些大量的属性、方法、事件在哪里查看呢？</p>
<ul>
<li>MDN文档：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window">https://developer.mozilla.org/zh-CN/docs/Web/API/Window</a></li>
</ul>
</li>
<li><p>查看MDN文档时，我们会发现有很多不同的符号，这里我解释一下是什么意思：</p>
<ul>
<li><p>删除符号：表示这个API已经废弃，不推荐继续使用了；</p>
</li>
<li><p>点踩符号：表示这个API不属于W3C规范，某些浏览器有实现（所以兼容性的问题）；</p>
</li>
<li><p>实验符号：该API是实验性特性，以后可能会修改，并且存在兼容性问题；</p>
</li>
</ul>
</li>
</ul>
<h3 id="window-常见属性"><a href="#window-常见属性" class="headerlink" title="window 常见属性"></a>window 常见属性</h3><ul>
<li>我们来看一下常见的window属性：</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/32.jpg" loading="lazy"></p>
<h3 id="window-常见方法"><a href="#window-常见方法" class="headerlink" title="window 常见方法"></a>window 常见方法</h3><ul>
<li>我们来看一下常见的window方法：</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/33.jpg" loading="lazy"></p>
<h3 id="window-常见事件"><a href="#window-常见事件" class="headerlink" title="window 常见事件"></a>window 常见事件</h3><ul>
<li>我们来看一下常见的window事件：</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/34.jpg" loading="lazy"></p>
<h3 id="EventTarget"><a href="#EventTarget" class="headerlink" title="EventTarget"></a>EventTarget</h3><ul>
<li><p>Window继承自EventTarget，所以会继承其中的属性和方法：</p>
<ul>
<li><p>addEventListener：注册某个事件类型以及事件处理函数；</p>
</li>
<li><p>removeEventListener：移除某个事件类型以及事件处理函数；</p>
</li>
<li><p>dispatchEvent：派发某个事件类型到EventTarget上；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/35.jpg" loading="lazy"></p>
<h2 id="Location-对象"><a href="#Location-对象" class="headerlink" title="Location 对象"></a>Location 对象</h2><h3 id="Location-对象常见的属性"><a href="#Location-对象常见的属性" class="headerlink" title="Location 对象常见的属性"></a>Location 对象常见的属性</h3><ul>
<li><p>Location对象用于表示window上当前链接到的URL信息。</p>
</li>
<li><p>常见的属性有哪些呢？</p>
<ul>
<li><p>href: 当前window对应的超链接URL, 整个URL； </p>
</li>
<li><p>protocol: 当前的协议；</p>
</li>
<li><p>host: 主机地址；</p>
</li>
<li><p>hostname: 主机地址(不带端口)； </p>
</li>
<li><p>port: 端口；</p>
</li>
<li><p>pathname: 路径；</p>
</li>
<li><p>search: 查询字符串；</p>
</li>
<li><p>hash: 哈希值；</p>
</li>
<li><p>username：URL中的username（很多浏览器已经禁用）；</p>
</li>
<li><p>password：URL中的password（很多浏览器已经禁用）；</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>我们会发现location其实是URL的一个抽象实现：</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/36.jpg" loading="lazy"></p>
<h3 id="Location-对象常用的方法"><a href="#Location-对象常用的方法" class="headerlink" title="Location 对象常用的方法"></a>Location 对象常用的方法</h3><ul>
<li><p>location有如下常用的方法：</p>
<ul>
<li><p>assign：赋值一个新的URL，并且跳转到该URL中；</p>
</li>
<li><p>replace：打开一个新的URL，并且跳转到该URL中（不同的是不会在浏览记录中留下之前的记录）；</p>
</li>
<li><p>reload：重新加载页面，可以传入一个Boolean类型；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/37.jpg" loading="lazy"></p>
<h2 id="History-对象"><a href="#History-对象" class="headerlink" title="History 对象"></a>History 对象</h2><ul>
<li><p>history对象允许我们访问浏览器曾经的会话历史记录。</p>
</li>
<li><p>有两个属性：</p>
<ul>
<li><p>length：会话中的记录条数；</p>
</li>
<li><p>state：当前保留的状态值；（通过 pushState 或 replaceState 传递）</p>
</li>
</ul>
</li>
<li><p>有五个方法：</p>
<ul>
<li><p>back()：返回上一页，等价于history.go(-1)； </p>
</li>
<li><p>forward()：前进下一页，等价于history.go(1)； </p>
</li>
<li><p>go()：加载历史中的某一页；</p>
</li>
<li><p>pushState()：打开一个指定的地址；</p>
</li>
<li><p>replaceState()：打开一个新的地址，并且使用replace；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/38.jpg" loading="lazy"></p>
<h2 id="认识-DOM-和架构"><a href="#认识-DOM-和架构" class="headerlink" title="认识 DOM 和架构"></a>认识 DOM 和架构</h2><ul>
<li><p>浏览器是用来展示网页的，而网页中最重要的就是里面各种的标签元素，JavaScript很多时候是需要操作这些元素的。</p>
<ul>
<li><p>JavaScript如何操作元素呢？通过Document Object Model（DOM，文档对象模型）。</p>
</li>
<li><p>DOM给我们提供了一系列的模型和对象，让我们可以方便的来操作Web页面。</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/39.jpg" loading="lazy"></p>
<ul>
<li>因为document和element继承自EventTarget，所以也可以使用EventTarget的方法：</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/40.jpg" loading="lazy"></p>
<h2 id="Node-节点"><a href="#Node-节点" class="headerlink" title="Node 节点"></a>Node 节点</h2><ul>
<li><p>所有的DOM节点类型都继承自Node接口。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node">https://developer.mozilla.org/zh-CN/docs/Web/API/Node</a></li>
</ul>
</li>
<li><p><strong>Node有几个非常重要的属性：</strong></p>
<ul>
<li><p>nodeName：node节点的名称。</p>
</li>
<li><p>nodeType：可以区分节点的类型。</p>
</li>
<li><p>nodeValue：node节点的值； </p>
</li>
<li><p>childNodes：所有的子节点；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>abc why<span class="token punctuation">"</span></span> <span class="token attr-name">age</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>why<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>span元素<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- 哈哈哈 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>切换标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./02_验证DOM都支持Node.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>



<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> divEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> spanEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 常见的属性</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>nodeName<span class="token punctuation">,</span> spanEl<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// DIV SPAN</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>nodeType<span class="token punctuation">,</span> spanEl<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 1	(TEXT节点是 3)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>nodeValue<span class="token punctuation">,</span> spanEl<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null null</span>

<span class="token comment">// childNodes</span>
<span class="token keyword">const</span> spanChildNodes <span class="token operator">=</span> spanEl<span class="token punctuation">.</span>childNodes<span class="token punctuation">;</span>
<span class="token keyword">const</span> textNode <span class="token operator">=</span> spanChildNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>textNode<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// span元素</span>

<span class="token comment">// 常见的方法</span>
<span class="token keyword">const</span> strongEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"strong"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
strongEl<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">"我是strong元素"</span><span class="token punctuation">;</span>
divEl<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>strongEl<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注意事项: document对象</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>strongEl<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h2 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h2><ul>
<li>Document节点表示的是整个载入的网页，我们来看一下常见的属性和方法：</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 常见的属性</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location <span class="token operator">===</span> document<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// true</span>

<span class="token comment">// 常见的方法</span>
<span class="token comment">// 创建元素</span>
<span class="token keyword">const</span> imageEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 此种写法本质上也是创建了一个HTMLImageElement 对象。</span>
<span class="token keyword">const</span> imageEl2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HTMLImageElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取元素</span>
<span class="token keyword">const</span> divEl1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> divEl2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> divEl3 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> divEl4 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> divEl5 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">".content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h2 id="Element"><a href="#Element" class="headerlink" title="Element"></a>Element</h2><ul>
<li>我们平时创建的div、p、span等元素在DOM中表示为Element元素，我们来看一下常见的属性和方法：</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> divEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#box"</span><span class="token punctuation">)</span>


<span class="token comment">// 常见的属性</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>tagName<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>className<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>classList<span class="token punctuation">)</span>	<span class="token comment">// 以数组的形式展示类名</span>
<span class="token comment">// clientWidth和clientHeight 为元素的宽高</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>clientWidth<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span>
<span class="token comment">// clientLeft、clientTop 为边框的宽度和高度</span>
<span class="token comment">// offsetLeft 与 offsetTop 为元素相对于父元素的左边与头部距离</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divEl<span class="token punctuation">.</span>offsetTop<span class="token punctuation">)</span>

<span class="token comment">// 常见的方法(addEventListener等 之外，还有下面这些特有的书写)</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> divEl<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
divEl<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token number">1.88</span><span class="token punctuation">)</span></code></pre>



<h2 id="认识事件监听"><a href="#认识事件监听" class="headerlink" title="认识事件监听"></a>认识事件监听</h2><ul>
<li><p>前面我们讲到了JavaScript脚本和浏览器之间交互时，浏览器给我们提供的BOM、DOM等一些对象模型。</p>
<ul>
<li><p>事实上还有一种需要和浏览器经常交互的事情就是事件监听： </p>
</li>
<li><p>浏览器在某个时刻可能会发生一些事件，比如鼠标点击、移动、滚动、获取、失去焦点、输入内容等等一系列的事件；</p>
</li>
</ul>
</li>
<li><p>我们需要以某种方式（代码）来对其进行响应，进行一些事件的处理； </p>
<ul>
<li>在Web当中，事件在浏览器窗口中被触发，并且通过绑定到某些元素上或者浏览器窗口本身，那么我们就可以给这些元素或者window窗口来绑定事件的处理程序，来对事件进行监听。 </li>
</ul>
</li>
<li><p>如何进行事件监听呢？</p>
<ul>
<li><p>事件监听方式一：在script中直接监听； </p>
</li>
<li><p>事件监听方式二：通过元素的on来监听事件；</p>
</li>
<li><p>事件监听方式三：通过EventTarget中的addEventListener来监听；</p>
</li>
</ul>
</li>
</ul>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- 第一种方式：直接监听 --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'div元素被点击'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- 第二种方式：使用回调函数形式监听 --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">divClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./05_常见的事件监听方式.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">divClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"div元素被点击2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 第三种方式：先拿到元素，再进行监听（注意，onclick的监听方是是不能重复定义的，会覆盖）</span>
<span class="token keyword">const</span> divEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// DOM0</span>
divEl<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"div元素被点击3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 此种addEventListener方式可以定义多次</span>
<span class="token comment">// DOM2</span>
divEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"div元素被点击4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
divEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"div元素被点击5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
divEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"div元素被点击6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<h2 id="认识事件流的由来"><a href="#认识事件流的由来" class="headerlink" title="认识事件流的由来"></a>认识事件流的由来</h2><ul>
<li><p>事实上对于事件有一个概念叫做事件流，为什么会产生事件流呢？</p>
<ul>
<li><p>我们可以想到一个问题：当我们在浏览器上对着一个元素点击时，你点击的不仅仅是这个元素本身；</p>
</li>
<li><p>这是因为我们的HTML元素是存在父子元素叠加层级的；</p>
</li>
<li><p>比如一个span元素是放在div元素上的，div元素是放在body元素上的，body元素是放在html元素上的；</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://pic-1308164762.cos.ap-shanghai.myqcloud.com/CodeWhy-JavaScript%E9%AB%98%E7%BA%A7-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/41.jpg" loading="lazy"></p>
<h2 id="事件冒泡和事件捕获"><a href="#事件冒泡和事件捕获" class="headerlink" title="事件冒泡和事件捕获"></a>事件冒泡和事件捕获</h2><ul>
<li><p>我们会发现默认情况下事件是从最内层的span向外依次传递的顺序，这个顺序我们称之为事件冒泡（Event Bubble）。</p>
<ul>
<li><p>事实上，还有另外一种监听事件流的方式就是从外层到内层（body -&gt; span），这种称之为事件捕获（Event Capture）；</p>
</li>
<li><p>为什么会产生两种不同的处理流呢？</p>
<ul>
<li><p>这是因为早期浏览器开发时，不管是IE还是Netscape公司都发现了这个问题，但是他们采用了完全相反的事件流来对事件进行了传递； </p>
</li>
<li><p>IE采用了事件冒泡的方式，Netscape采用了事件捕获的方式； </p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>那么我们如何去监听事件捕获的过程呢？</p>
</li>
</ul>
<p><img src="/blogs/6af01b42/42.jpg" loading="lazy"></p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    div元素
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>span<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>span元素<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./06_事件冒泡和事件捕获.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>

<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> spanEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".span"</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> divEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".container"</span><span class="token punctuation">)</span>

spanEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"事件冒泡:span元素被点击了"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

divEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"事件冒泡:div元素被点击了"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"事件冒泡:body元素被点击了"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 再次监听</span>
spanEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"事件捕获:span元素被点击了"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

divEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"事件捕获:div元素被点击了"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"事件捕获:body元素被点击了"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></code></pre>

<ul>
<li>如果我们同时有事件冒泡和时间捕获的监听，那么会优先监听到事件捕获的。</li>
</ul>
<h2 id="事件对象-event"><a href="#事件对象-event" class="headerlink" title="事件对象 event"></a>事件对象 event</h2><ul>
<li><p>当一个事件发生时，就会有和这个事件相关的很多信息：</p>
<ul>
<li><p>比如事件的类型是什么，你点击的是哪一个元素，点击的位置是哪里等等相关的信息；</p>
</li>
<li><p>那么这些信息会被封装到一个Event对象中；</p>
</li>
<li><p>该对象给我们提供了想要的一些属性，以及可以通过该对象进行某些操作；</p>
</li>
</ul>
</li>
<li><p>常见的属性：</p>
<ul>
<li><p>type：事件的类型；</p>
</li>
<li><p>target：当前事件发生的元素；</p>
</li>
<li><p>currentTarget：当前处理事件的元素；（比如div里面有span，当我们点击只给div绑定事件，点击span，target就为 span，而 currentTarget 为div）</p>
</li>
<li><p>offsetX、offsetY：点击元素的位置；</p>
</li>
</ul>
</li>
<li><p>常见的方法：</p>
<ul>
<li><p>preventDefault：取消事件的默认行为；</p>
</li>
<li><p>stopPropagation：阻止事件的进一步传递；</p>
</li>
</ul>
</li>
<li><p>事件类型：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Event">https://developer.mozilla.org/zh-CN/docs/Web/Event</a></p>
</li>
</ul>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> spanEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

spanEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"span元素被点击:"</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"事件的类型:"</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"事件的元素:"</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"事件发生的位置:"</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>offsetX<span class="token punctuation">,</span> event<span class="token punctuation">.</span>offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> divEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".container"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
divEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"div元素被点击:"</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">,</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 常见的方法</span>
<span class="token comment">// preventDefault</span>
<span class="token comment">// stopPropagation</span>
<span class="token keyword">const</span> aEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
aEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<h1 id="防抖-节流-深拷贝-事件总线"><a href="#防抖-节流-深拷贝-事件总线" class="headerlink" title="防抖-节流-深拷贝-事件总线"></a>防抖-节流-深拷贝-事件总线</h1><h2 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h2><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 1.定义一个定时器，来保存上一次的定时器对象</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">//  2.真正执行的函数</span>
  <span class="token keyword">const</span> <span class="token function-variable function">_debounce</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 取消上一次的定时器</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 延迟执行</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 外部传入的真正要执行的函数</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> _debounce<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h2><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 1.记录上一次的开始时间</span>
  <span class="token keyword">let</span> lastTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// 2.事件触发时，真正执行的函数</span>
  <span class="token keyword">const</span> <span class="token function-variable function">_throttle</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 2.1 获取当前事件触发时的时间</span>
    <span class="token keyword">const</span> nowTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.2 使用当前触发的时间和之前的时间间隔以及上一次开始的时间，计算出还剩余多长时间需要去触发函数</span>
    <span class="token keyword">const</span> remainTime <span class="token operator">=</span> interval <span class="token operator">-</span> <span class="token punctuation">(</span>nowTime <span class="token operator">-</span> lastTime<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认第一次会执行</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>remainTime <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 2.3 真正触发函数</span>
      <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 2.4 保留上次触发的时间</span>
      lastTime <span class="token operator">=</span> nowTime<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> _throttle<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h2><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> valueType <span class="token operator">=</span> <span class="token keyword">typeof</span> value<span class="token punctuation">;</span>
  <span class="token keyword">return</span> value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>valueType <span class="token operator">===</span> <span class="token string">"object"</span> <span class="token operator">||</span> valueType <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// console.log(typeof null);   // object</span>

<span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">originValue</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 判断传入的originValue 是否是一个对象类型</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>originValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> originValue<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> newObject <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> originValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    newObject<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>originValue<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> newObject<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 测试代码</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token string">"why"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  friend<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token string">"james"</span><span class="token punctuation">,</span>
    address<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      city<span class="token operator">:</span> <span class="token string">"广州"</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj <span class="token operator">===</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>friend<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"kobe"</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h2 id="自定义事件总线"><a href="#自定义事件总线" class="headerlink" title="自定义事件总线"></a>自定义事件总线</h2><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">XCEventBus</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>eventBus <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> eventCallback<span class="token punctuation">,</span> thisArgument</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> handlers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventBus<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>handlers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      handlers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>eventBus<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> handlers<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    handlers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      eventCallback<span class="token punctuation">,</span>
      thisArgument<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> eventCallback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> handlers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventBus<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>handlers<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newHandlers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>handlers<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newHandlers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> handler <span class="token operator">=</span> newHandlers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>handler<span class="token punctuation">.</span>eventCallback <span class="token operator">===</span> eventCallback<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> index <span class="token operator">=</span> handlers<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        handlers<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> <span class="token operator">...</span>payload</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> handlers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventBus<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>handlers<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    handlers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      handler<span class="token punctuation">.</span><span class="token function">eventCallback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>handler<span class="token punctuation">.</span>thisArg<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> eventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XCEventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// main.js</span>
eventBus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>
  <span class="token string">"abc"</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"监听abc"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"why"</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"监听abc"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

eventBus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">,</span> handleCallback<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"why"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// util.js</span>
eventBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

eventBus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">,</span> handleCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

eventBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<p><img src="/blogs/6af01b42/.jpg" loading="lazy"></p>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>语轻星子</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://xxcijmz.top/blogs/6af01b42/" title="CodeWhy-JavaScript高级-学习笔记2">https://xxcijmz.top/blogs/6af01b42/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/blogs/f3f94af8/" rel="next" title="CodeWhy-JavaScript高级-学习笔记1"><span class="post-nav-text">CodeWhy-JavaScript高级-学习笔记1</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div><div id="valine-container"></div><script>Yun.utils.getScript("https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js", () => {
  const valineConfig = {"enable":true,"appId":"MnqOxUn1tp2XfaBiRJqcPNC3-MdYXbMMI","appKey":"BUJAYYUt5IhdIDVVvHH8aHMx","placeholder":"来与我一起讨论吧","avatar":null,"pageSize":10,"visitor":false,"highlight":true,"recordIP":false,"enableQQ":true,"meta":["nick"],"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = "/blogs/6af01b42/"
  new Valine(valineConfig)
}, window.Valine);</script></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">闽ICP备2021017107号-1</a></div><div class="copyright"><span>&copy; 2021 – 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 语轻星子</span></div><div class="live_time"><span>本博客已运行：</span><span id="display_live_time"></span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2021-09-23T00:03:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#5698c3" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script defer src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script defer src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script defer src="/js/search/algolia-search.js"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div class="algolia-pagination" id="algolia-pagination"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.9},"dialog":{"enable":true},"log":false});</script></body></html>